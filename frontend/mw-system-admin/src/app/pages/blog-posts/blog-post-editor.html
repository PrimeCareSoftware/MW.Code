<app-navbar></app-navbar>

<div class="page-container">
  <div class="page-header">
    <h1>{{ isEditMode ? 'Editar Post' : 'Novo Post' }}</h1>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="cancel()">Cancelar</button>
      <button class="btn btn-primary" (click)="save()" [disabled]="saving()">
        {{ saving() ? 'Salvando...' : 'Salvar' }}
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Carregando post...</p>
    </div>
  } @else {
    @if (error()) {
      <div class="error-message">
        {{ error() }}
      </div>
    }

    <div class="editor-container">
      <div class="form-section">
        <label class="form-label">
          T√≠tulo *
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="formData.title"
            placeholder="Digite o t√≠tulo do post"
            maxlength="500"
          >
        </label>

        <label class="form-label">
          Categoria *
          <input 
            type="text" 
            class="form-input" 
            [(ngModel)]="formData.category"
            placeholder="Ex: Telemedicina, Gest√£o, Tecnologia"
            maxlength="100"
          >
        </label>

        <div class="form-row">
          <label class="form-label">
            Tempo de Leitura (minutos) *
            <input 
              type="number" 
              class="form-input" 
              [(ngModel)]="formData.readTimeMinutes"
              min="1"
              max="60"
            >
          </label>

          <label class="form-label">
            Imagem Destacada (URL)
            <input 
              type="text" 
              class="form-input" 
              [(ngModel)]="formData.featuredImage"
              placeholder="https://exemplo.com/imagem.jpg"
            >
          </label>
        </div>

        <label class="form-label">
          Resumo *
          <textarea 
            class="form-textarea" 
            [(ngModel)]="formData.excerpt"
            placeholder="Escreva um breve resumo do post (m√°ximo 1000 caracteres)"
            rows="3"
            maxlength="1000"
          ></textarea>
          <small class="char-count">{{ formData.excerpt.length }}/1000</small>
        </label>

        <label class="form-label">
          Conte√∫do *
          <div class="editor-toolbar">
            <button type="button" class="toolbar-btn" (click)="formatText('bold')" title="Negrito">
              <strong>B</strong>
            </button>
            <button type="button" class="toolbar-btn" (click)="formatText('italic')" title="It√°lico">
              <em>I</em>
            </button>
            <span class="toolbar-separator"></span>
            <button type="button" class="toolbar-btn" (click)="formatText('heading2')" title="T√≠tulo">
              H2
            </button>
            <button type="button" class="toolbar-btn" (click)="formatText('heading3')" title="Subt√≠tulo">
              H3
            </button>
            <span class="toolbar-separator"></span>
            <button type="button" class="toolbar-btn" (click)="formatText('list')" title="Lista">
              ‚â°
            </button>
            <button type="button" class="toolbar-btn" (click)="formatText('link')" title="Link">
              üîó
            </button>
            <button type="button" class="toolbar-btn" (click)="formatText('image')" title="Imagem">
              üñºÔ∏è
            </button>
          </div>
          <textarea 
            id="content-editor"
            class="form-textarea content-editor" 
            [(ngModel)]="formData.content"
            placeholder="Escreva o conte√∫do do post... Use Markdown ou HTML b√°sico"
            rows="20"
          ></textarea>
          <div class="editor-help">
            <p><strong>Dica:</strong> Use Markdown para formata√ß√£o:</p>
            <ul>
              <li>**negrito** para <strong>negrito</strong></li>
              <li>*it√°lico* para <em>it√°lico</em></li>
              <li>## T√≠tulo para t√≠tulos</li>
              <li>- item para listas</li>
              <li>[texto](url) para links</li>
              <li>![alt](url) para imagens</li>
            </ul>
          </div>
        </label>
      </div>

      <div class="preview-section">
        <h3>Pr√©-visualiza√ß√£o</h3>
        <div class="preview-card">
          @if (formData.title) {
            <h2 class="preview-title">{{ formData.title }}</h2>
          }
          @if (formData.category) {
            <span class="preview-category">{{ formData.category }}</span>
          }
          @if (formData.excerpt) {
            <p class="preview-excerpt">{{ formData.excerpt }}</p>
          }
          @if (formData.content) {
            <div class="preview-content">
              <p>{{ formData.content | slice:0:300 }}...</p>
            </div>
          }
          @if (formData.readTimeMinutes) {
            <small class="preview-meta">‚è±Ô∏è {{ formData.readTimeMinutes }} min de leitura</small>
          }
        </div>
      </div>
    </div>
  }
</div>
