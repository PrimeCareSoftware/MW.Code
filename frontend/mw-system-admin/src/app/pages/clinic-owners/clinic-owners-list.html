<app-navbar></app-navbar>

<div class="owners-list">
      <div class="header">
        <div>
          <h1>Gerenciar Propriet√°rios de Cl√≠nicas</h1>
          <p class="subtitle">Gerencie acesso e senhas dos propriet√°rios</p>
        </div>
      </div>

      @if (loading()) {
        <div class="loading">Carregando propriet√°rios...</div>
      } @else if (error()) {
        <div class="error">{{ error() }}</div>
      } @else {
        <div class="table-container">
          <table class="owners-table">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Username</th>
                <th>Email</th>
                <th>Cl√≠nica</th>
                <th>√öltimo Login</th>
                <th>Status</th>
                <th>E-mail Confirmado</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              @for (owner of owners(); track owner.id) {
                <tr>
                  <td>{{ owner.fullName }}</td>
                  <td>{{ owner.username }}</td>
                  <td>{{ owner.email }}</td>
                  <td>{{ owner.clinicName || 'System Owner' }}</td>
                  <td>{{ owner.lastLoginAt ? formatDate(owner.lastLoginAt) : 'Nunca' }}</td>
                  <td>
                    <span class="status-badge" [class.active]="owner.isActive" [class.inactive]="!owner.isActive">
                      {{ owner.isActive ? '‚úÖ Ativo' : 'üö´ Inativo' }}
                    </span>
                  </td>
                  <td>
                    <span class="status-badge" [class.active]="owner.isEmailConfirmed" [class.inactive]="!owner.isEmailConfirmed">
                      {{ owner.isEmailConfirmed ? '‚úÖ Confirmado' : '‚è≥ Pendente' }}
                    </span>
                  </td>
                  <td>
                    <div class="actions">
                      <button class="btn-icon" (click)="openResetPasswordModal(owner)" title="Resetar Senha">
                        üîë
                      </button>
                      <button 
                        class="btn-icon" 
                        [class.btn-danger]="owner.isActive"
                        [class.btn-success]="!owner.isActive"
                        (click)="toggleStatus(owner.id, owner.isActive)" 
                        [title]="owner.isActive ? 'Suspender' : 'Ativar'"
                      >
                        {{ owner.isActive ? 'üö´' : '‚úÖ' }}
                      </button>
                      @if (!owner.isEmailConfirmed) {
                        <button 
                          class="btn-icon btn-success" 
                          (click)="confirmAccess(owner.id, owner.fullName)"
                          title="Confirmar Acesso (sem e-mail)"
                        >
                          üîì
                        </button>
                        <button 
                          class="btn-icon"
                          (click)="resendConfirmation(owner.id)"
                          title="Reenviar E-mail de Confirma√ß√£o"
                        >
                          üìß
                        </button>
                      }
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>

          @if (owners().length === 0) {
            <div class="empty-state">
              <p>Nenhum propriet√°rio encontrado</p>
            </div>
          }
        </div>
      }

      <!-- Reset Password Modal -->
      @if (showResetPasswordModal && selectedOwner) {
        <div class="modal-overlay" (click)="closeModal()">
          <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2>Resetar Senha</h2>
              <button class="btn-close" (click)="closeModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
              <p>Resetar senha para: <strong>{{ selectedOwner.fullName }}</strong></p>
              
              <div class="form-group">
                <label>Nova Senha *</label>
                <input
                  type="password"
                  [(ngModel)]="newPassword"
                  placeholder="Digite a nova senha"
                  minlength="8"
                />
              </div>

              @if (modalError()) {
                <div class="error-message">{{ modalError() }}</div>
              }
            </div>

            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="closeModal()">
                Cancelar
              </button>
              <button class="btn btn-primary" (click)="resetPassword()" [disabled]="!newPassword || submitting()">
                @if (submitting()) {
                  <span>Resetando...</span>
                } @else {
                  <span>Resetar Senha</span>
                }
              </button>
            </div>
          </div>
        </div>
      }
    </div>
