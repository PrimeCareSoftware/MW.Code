<div class="template-editor-container">
  <div class="page-header">
    <h1>
      {{ isViewMode ? 'Visualizar Template' : (isEditMode ? 'Editar Template' : 'Novo Template') }}
    </h1>
    <p class="subtitle">
      {{ isViewMode ? 'Detalhes do template de impress√£o' : 'Configure o template com vari√°veis personaliz√°veis' }}
    </p>
  </div>

  <!-- Notifications -->
  <div *ngIf="error" class="notification error">
    <span class="icon">‚ö†Ô∏è</span>
    <span>{{ error }}</span>
    <button class="close-btn" (click)="error = null">√ó</button>
  </div>

  <div *ngIf="success" class="notification success">
    <span class="icon">‚úì</span>
    <span>{{ success }}</span>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Carregando template...</p>
  </div>

  <!-- Editor Form -->
  <form [formGroup]="form" *ngIf="!loading" class="editor-form">
    <div class="form-row">
      <div class="form-group full-width">
        <label for="name">Nome do Template *</label>
        <input 
          type="text" 
          id="name" 
          formControlName="name" 
          class="form-control"
          placeholder="Ex: Receita M√©dica Padr√£o"
          [readOnly]="isViewMode"
        />
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="specialty">Especialidade *</label>
        <select 
          id="specialty" 
          formControlName="specialty" 
          class="form-control"
          [disabled]="isEditMode || isViewMode"
        >
          <option [ngValue]="null">Selecione uma especialidade</option>
          <option *ngFor="let spec of specialties" [ngValue]="spec.value">
            {{ spec.label }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="type">Tipo de Documento *</label>
        <select 
          id="type" 
          formControlName="type" 
          class="form-control"
          [disabled]="isEditMode || isViewMode"
        >
          <option [ngValue]="null">Selecione um tipo</option>
          <option *ngFor="let type of templateTypes" [ngValue]="type.value">
            {{ type.label }}
          </option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group full-width">
        <label for="description">Descri√ß√£o</label>
        <input 
          type="text" 
          id="description" 
          formControlName="description" 
          class="form-control"
          placeholder="Breve descri√ß√£o do template"
          [readOnly]="isViewMode"
        />
      </div>
    </div>

    <div class="editor-section">
      <div class="section-header">
        <h3>Conte√∫do do Template</h3>
        <p class="help-text">
          Use vari√°veis no formato <code>{{'{{patientName}}'}}</code> para inserir dados din√¢micos
        </p>
      </div>

      <div class="editor-layout">
        <!-- Variables Sidebar -->
        <div class="variables-sidebar">
          <h4>Vari√°veis Dispon√≠veis</h4>
          <p class="sidebar-help">Clique para inserir no conte√∫do</p>
          
          <div class="variables-list">
            <button 
              *ngFor="let variable of variablesFormArray.controls; let i = index"
              type="button"
              class="variable-btn"
              (click)="insertVariable(variable.value.key)"
              [disabled]="isViewMode"
            >
              <span class="variable-key">{{variable.value.key}}</span>
              <span class="variable-label">{{ variable.value.label }}</span>
              <span *ngIf="variable.value.isRequired" class="required-badge">*</span>
            </button>
          </div>

          <button 
            type="button" 
            class="btn btn-secondary btn-sm"
            (click)="addVariable()"
            *ngIf="!isViewMode"
          >
            ‚ûï Nova Vari√°vel
          </button>

          <button 
            type="button" 
            class="btn btn-link btn-sm"
            (click)="resetToCommonVariables()"
            *ngIf="!isViewMode"
          >
            üîÑ Resetar Padr√£o
          </button>
        </div>

        <!-- Content Editor -->
        <div class="content-editor">
          <textarea 
            formControlName="content"
            class="content-textarea"
            placeholder="Digite o conte√∫do do template aqui...

Exemplo:
RECEITA M√âDICA

Paciente: {{ '{{patientName}}' }}
Data: {{ '{{consultationDate}}' }}

Prescrevo:
[Escreva aqui a prescri√ß√£o]

_______________
{{ '{{professionalName}}' }}
{{ '{{professionalRegistration}}' }}"
            rows="20"
            [readOnly]="isViewMode"
          ></textarea>

          <div class="content-info">
            <small>
              üí° Dica: Use o formato {{'{{variableName}}'}} para inserir vari√°veis din√¢micas
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Variables Configuration -->
    <div class="variables-config" *ngIf="!isViewMode">
      <h3>Configura√ß√£o de Vari√°veis</h3>
      <p class="help-text">Personalize as vari√°veis dispon√≠veis para este template</p>

      <div class="variables-table">
        <div class="table-header">
          <div class="col">Chave</div>
          <div class="col">R√≥tulo</div>
          <div class="col">Tipo</div>
          <div class="col">Obrigat√≥ria</div>
          <div class="col">A√ß√µes</div>
        </div>

        <div 
          *ngFor="let variable of variablesFormArray.controls; let i = index"
          class="table-row"
          [formGroup]="$any(variable)"
        >
          <div class="col">
            <input type="text" formControlName="key" class="form-control-sm" />
          </div>
          <div class="col">
            <input type="text" formControlName="label" class="form-control-sm" />
          </div>
          <div class="col">
            <select formControlName="type" class="form-control-sm">
              <option value="text">Texto</option>
              <option value="date">Data</option>
              <option value="number">N√∫mero</option>
              <option value="boolean">Sim/N√£o</option>
            </select>
          </div>
          <div class="col">
            <input type="checkbox" formControlName="isRequired" />
          </div>
          <div class="col">
            <button 
              type="button" 
              class="btn-icon btn-danger"
              (click)="removeVariable(i)"
              title="Remover"
            >
              üóëÔ∏è
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="cancel()"
      >
        {{ isViewMode ? 'Voltar' : 'Cancelar' }}
      </button>

      <button 
        *ngIf="!isViewMode"
        type="button" 
        class="btn btn-primary"
        (click)="save()"
        [disabled]="saving || form.invalid"
      >
        {{ saving ? 'Salvando...' : (isEditMode ? 'Atualizar Template' : 'Criar Template') }}
      </button>
    </div>
  </form>
</div>
