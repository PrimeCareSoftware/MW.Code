<app-navbar></app-navbar>

<div class="page-container">
  <div class="page-header">
    <div>
      <h1>Dashboards Customizados</h1>
      <p class="subtitle">Crie e gerencie seus dashboards personalizados</p>
    </div>
    <button mat-raised-button color="primary" (click)="createDashboard()">
      <mat-icon>add</mat-icon>
      Novo Dashboard
    </button>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  } @else if (error()) {
    <div class="error-container">
      <mat-icon color="warn">error</mat-icon>
      <p>{{ error() }}</p>
    </div>
  } @else {
    <div class="dashboards-grid">
      @for (dashboard of dashboards(); track dashboard.id) {
        <mat-card class="dashboard-card" (click)="openDashboard(dashboard.id)">
          <mat-card-header>
            <mat-card-title>{{ dashboard.name }}</mat-card-title>
            <button mat-icon-button [matMenuTriggerFor]="menu" (click)="$event.stopPropagation()">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="editDashboard(dashboard.id)">
                <mat-icon>edit</mat-icon>
                <span>Editar</span>
              </button>
              <button mat-menu-item (click)="duplicateDashboard(dashboard.id)">
                <mat-icon>content_copy</mat-icon>
                <span>Duplicar</span>
              </button>
              <button mat-menu-item (click)="exportDashboard(dashboard.id)">
                <mat-icon>download</mat-icon>
                <span>Exportar</span>
              </button>
              <button mat-menu-item (click)="deleteDashboard(dashboard.id)" class="delete-button">
                <mat-icon>delete</mat-icon>
                <span>Excluir</span>
              </button>
            </mat-menu>
          </mat-card-header>
          <mat-card-content>
            <p class="description">{{ dashboard.description }}</p>
            <div class="dashboard-meta">
              <span class="meta-item">
                <mat-icon>widgets</mat-icon>
                {{ dashboard.widgets.length }} widgets
              </span>
              @if (dashboard.isDefault) {
                <span class="badge default">Padrão</span>
              }
              @if (dashboard.isPublic) {
                <span class="badge public">Público</span>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }
    </div>

    @if (dashboards().length === 0) {
      <div class="empty-state">
        <mat-icon>dashboard</mat-icon>
        <h2>Nenhum dashboard criado</h2>
        <p>Crie seu primeiro dashboard customizado para visualizar métricas importantes</p>
        <button mat-raised-button color="primary" (click)="createDashboard()">
          <mat-icon>add</mat-icon>
          Criar Dashboard
        </button>
      </div>
    }
  }
</div>
