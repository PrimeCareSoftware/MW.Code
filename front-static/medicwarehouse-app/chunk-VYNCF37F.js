import{a as L,b as d,c as q,d as A,e as j,f as H,h as Y,i as W,j as U,k as $,l as J,m as K,o as Q,p as X,q as Z}from"./chunk-HJDNBRIJ.js";import{a as te}from"./chunk-Z4ZWIJEB.js";import{a as ee}from"./chunk-YHTCB7RM.js";import{$ as r,Aa as B,B as s,Ca as R,D as _,Da as V,E as N,N as f,O as v,Q as F,R as z,S as p,T as n,U as t,V as c,W as x,X as h,Y as m,a as O,aa as M,b as E,ba as P,c as S,da as k,ea as T,fa as G,i as w,ia as I,r as b,s as C,ta as D,x as g}from"./chunk-5XZGLIZJ.js";var ie=()=>({standalone:!0}),ae=(o,i)=>i.id;function oe(o,i){if(o&1&&(n(0,"div",3),r(1),t()),o&2){let e=m();s(),M(e.errorMessage())}}function se(o,i){if(o&1&&(n(0,"div",4),r(1),t()),o&2){let e=m();s(),M(e.successMessage())}}function de(o,i){if(o&1){let e=x();n(0,"div",56),h("click",function(){let l=b(e).$implicit,u=m(3);return C(u.selectGuardian(l))}),n(1,"div",57)(2,"strong"),r(3),t(),n(4,"span",58),r(5),t(),n(6,"span",59),r(7),t()()()}if(o&2){let e=i.$implicit;s(3),M(e.name),s(2),P("CPF: ",e.document),s(2),P("",e.age," anos")}}function le(o,i){if(o&1&&(n(0,"div",52),F(1,de,8,3,"div",55,ae),t()),o&2){let e=m(2);s(),z(e.guardianSearchResults())}}function ce(o,i){if(o&1){let e=x();n(0,"div",53)(1,"strong"),r(2,"Respons\xE1vel selecionado:"),t(),r(3),n(4,"button",60),h("click",function(){b(e);let l=m(2);return C(l.clearGuardian())}),r(5,"\u2715"),t()()}if(o&2){let e=m(2);s(3),P(" ",e.selectedGuardian().name," ")}}function me(o,i){if(o&1){let e=x();n(0,"div",21)(1,"div",48)(2,"label",49),r(3,"Respons\xE1vel *"),t(),n(4,"div",50)(5,"input",51),G("ngModelChange",function(l){b(e);let u=m();return T(u.guardianSearchTerm,l)||(u.guardianSearchTerm=l),C(l)}),h("input",function(){b(e);let l=m();return C(l.searchGuardian())}),t(),f(6,le,3,0,"div",52),f(7,ce,6,1,"div",53),t(),n(8,"small",54),r(9,"Crian\xE7as menores de 18 anos devem ter um respons\xE1vel cadastrado."),t()()()}if(o&2){let e=m();s(5),k("ngModel",e.guardianSearchTerm),p("ngModelOptions",I(4,ie)),s(),v(e.guardianSearchResults().length>0?6:-1),s(),v(e.selectedGuardian()?7:-1)}}var ne=class o{constructor(i,e,a,l){this.fb=i;this.patientService=e;this.route=a;this.router=l;this.patientForm=this.fb.group({name:["",[d.required]],document:["",[d.required]],dateOfBirth:["",[d.required]],gender:["",[d.required]],email:["",[d.required,d.email]],phoneCountryCode:["+55",[d.required]],phoneNumber:["",[d.required]],address:this.fb.group({street:["",[d.required]],number:["",[d.required]],complement:[""],neighborhood:["",[d.required]],city:["",[d.required]],state:["",[d.required]],zipCode:["",[d.required]],country:["Brasil",[d.required]]}),medicalHistory:[""],allergies:[""]}),this.searchSubject.pipe(w(300)).subscribe(u=>{u.length>=3?this.patientService.search(u).subscribe({next:y=>{this.guardianSearchResults.set(y.filter(re=>!re.isChild))},error:y=>{console.error("Error searching patients:",y)}}):this.guardianSearchResults.set([])})}patientForm;isEditMode=g(!1);patientId=g(null);isLoading=g(!1);errorMessage=g("");successMessage=g("");isChildPatient=g(!1);guardianSearchTerm="";guardianSearchResults=g([]);selectedGuardian=g(null);searchSubject=new S;ngOnInit(){let i=this.route.snapshot.paramMap.get("id");i&&(this.isEditMode.set(!0),this.patientId.set(i),this.loadPatient(i))}onDateOfBirthChange(){let i=this.patientForm.get("dateOfBirth")?.value;if(i){let e=this.calculateAge(new Date(i));this.isChildPatient.set(e<18),e>=18&&this.selectedGuardian.set(null)}}calculateAge(i){let e=new Date,a=e.getFullYear()-i.getFullYear(),l=e.getMonth()-i.getMonth();return(l<0||l===0&&e.getDate()<i.getDate())&&a--,a}searchGuardian(){this.searchSubject.next(this.guardianSearchTerm)}selectGuardian(i){this.selectedGuardian.set(i),this.guardianSearchResults.set([]),this.guardianSearchTerm=i.name}clearGuardian(){this.selectedGuardian.set(null),this.guardianSearchTerm=""}loadPatient(i){this.isLoading.set(!0),this.patientService.getById(i).subscribe({next:e=>{this.patientForm.patchValue({name:e.name,document:e.document,dateOfBirth:e.dateOfBirth.split("T")[0],gender:e.gender,email:e.email,phoneCountryCode:"+55",phoneNumber:e.phone.replace("+55",""),address:e.address,medicalHistory:e.medicalHistory,allergies:e.allergies}),this.isChildPatient.set(e.isChild),e.guardianId&&e.guardianName&&(this.selectedGuardian.set({id:e.guardianId,name:e.guardianName,document:"",dateOfBirth:"",gender:"",email:"",phone:"",address:{street:"",number:"",neighborhood:"",city:"",state:"",zipCode:"",country:""},isActive:!0,age:0,isChild:!1,createdAt:""}),this.guardianSearchTerm=e.guardianName),this.isLoading.set(!1)},error:e=>{this.errorMessage.set("Erro ao carregar paciente"),this.isLoading.set(!1),console.error("Error loading patient:",e)}})}onSubmit(){if(this.patientForm.valid){if(this.isChildPatient()&&!this.selectedGuardian()&&!this.isEditMode()){this.errorMessage.set("Crian\xE7as menores de 18 anos devem ter um respons\xE1vel");return}this.isLoading.set(!0),this.errorMessage.set(""),this.successMessage.set("");let i=this.patientForm.value;if(this.isEditMode()){let e={name:i.name,email:i.email,phoneCountryCode:i.phoneCountryCode,phoneNumber:i.phoneNumber,address:i.address,medicalHistory:i.medicalHistory,allergies:i.allergies};this.patientService.update(this.patientId(),e).subscribe({next:()=>{this.successMessage.set("Paciente atualizado com sucesso!"),this.isLoading.set(!1),setTimeout(()=>this.router.navigate(["/patients"]),1500)},error:a=>{this.errorMessage.set("Erro ao atualizar paciente"),this.isLoading.set(!1),console.error("Error updating patient:",a)}})}else{let e=E(O({},i),{guardianId:this.selectedGuardian()?.id});this.patientService.create(e).subscribe({next:()=>{this.successMessage.set("Paciente cadastrado com sucesso!"),this.isLoading.set(!1),setTimeout(()=>this.router.navigate(["/patients"]),1500)},error:a=>{this.errorMessage.set("Erro ao cadastrar paciente"),this.isLoading.set(!1),console.error("Error creating patient:",a)}})}}}static \u0275fac=function(e){return new(e||o)(_(Q),_(te),_(B),_(R))};static \u0275cmp=N({type:o,selectors:[["app-patient-form"]],decls:102,vars:10,consts:[[1,"patient-form-container"],[1,"page-header"],["routerLink","/patients",1,"btn","btn-secondary"],[1,"alert","alert-error"],[1,"alert","alert-success"],[1,"patient-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-row"],[1,"form-group"],["for","name"],["type","text","id","name","formControlName","name",1,"form-control"],["for","document"],["type","text","id","document","formControlName","document",1,"form-control",3,"readonly"],["for","dateOfBirth"],["type","date","id","dateOfBirth","formControlName","dateOfBirth",1,"form-control",3,"change","readonly"],["for","gender"],["id","gender","formControlName","gender",1,"form-control",3,"disabled"],["value",""],["value","M"],["value","F"],["value","O"],[1,"form-row","guardian-section"],["for","email"],["type","email","id","email","formControlName","email",1,"form-control"],["for","phoneNumber"],["type","text","id","phoneNumber","formControlName","phoneNumber",1,"form-control"],["formGroupName","address",1,"form-section"],["for","zipCode"],["type","text","id","zipCode","formControlName","zipCode",1,"form-control"],["for","street"],["type","text","id","street","formControlName","street",1,"form-control"],["for","number"],["type","text","id","number","formControlName","number",1,"form-control"],["for","complement"],["type","text","id","complement","formControlName","complement",1,"form-control"],["for","neighborhood"],["type","text","id","neighborhood","formControlName","neighborhood",1,"form-control"],["for","city"],["type","text","id","city","formControlName","city",1,"form-control"],["for","state"],["type","text","id","state","formControlName","state",1,"form-control"],["for","medicalHistory"],["id","medicalHistory","formControlName","medicalHistory","rows","3",1,"form-control"],["for","allergies"],["id","allergies","formControlName","allergies","rows","3",1,"form-control"],[1,"form-actions"],["type","button","routerLink","/patients",1,"btn","btn-secondary"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"form-group","full-width"],["for","guardianSearch"],[1,"guardian-search"],["type","text","id","guardianSearch","placeholder","Digite o nome ou CPF do respons\xE1vel",1,"form-control",3,"ngModelChange","input","ngModel","ngModelOptions"],[1,"search-results"],[1,"selected-guardian"],[1,"form-text"],[1,"search-result-item"],[1,"search-result-item",3,"click"],[1,"patient-info"],[1,"document"],[1,"age"],["type","button",1,"btn-remove",3,"click"]],template:function(e,a){e&1&&(c(0,"app-navbar"),n(1,"div",0)(2,"div",1)(3,"h1"),r(4),t(),n(5,"button",2),r(6,"Voltar"),t()(),f(7,oe,2,1,"div",3),f(8,se,2,1,"div",4),n(9,"form",5),h("ngSubmit",function(){return a.onSubmit()}),n(10,"div",6)(11,"h3"),r(12,"Dados Pessoais"),t(),n(13,"div",7)(14,"div",8)(15,"label",9),r(16,"Nome Completo *"),t(),c(17,"input",10),t(),n(18,"div",8)(19,"label",11),r(20,"CPF *"),t(),c(21,"input",12),t()(),n(22,"div",7)(23,"div",8)(24,"label",13),r(25,"Data de Nascimento *"),t(),n(26,"input",14),h("change",function(){return a.onDateOfBirthChange()}),t()(),n(27,"div",8)(28,"label",15),r(29,"G\xEAnero *"),t(),n(30,"select",16)(31,"option",17),r(32,"Selecione"),t(),n(33,"option",18),r(34,"Masculino"),t(),n(35,"option",19),r(36,"Feminino"),t(),n(37,"option",20),r(38,"Outro"),t()()()(),f(39,me,10,5,"div",21),t(),n(40,"div",6)(41,"h3"),r(42,"Contato"),t(),n(43,"div",7)(44,"div",8)(45,"label",22),r(46,"E-mail *"),t(),c(47,"input",23),t(),n(48,"div",8)(49,"label",24),r(50,"Telefone *"),t(),c(51,"input",25),t()()(),n(52,"div",26)(53,"h3"),r(54,"Endere\xE7o"),t(),n(55,"div",7)(56,"div",8)(57,"label",27),r(58,"CEP *"),t(),c(59,"input",28),t(),n(60,"div",8)(61,"label",29),r(62,"Rua *"),t(),c(63,"input",30),t()(),n(64,"div",7)(65,"div",8)(66,"label",31),r(67,"N\xFAmero *"),t(),c(68,"input",32),t(),n(69,"div",8)(70,"label",33),r(71,"Complemento"),t(),c(72,"input",34),t()(),n(73,"div",7)(74,"div",8)(75,"label",35),r(76,"Bairro *"),t(),c(77,"input",36),t(),n(78,"div",8)(79,"label",37),r(80,"Cidade *"),t(),c(81,"input",38),t(),n(82,"div",8)(83,"label",39),r(84,"Estado *"),t(),c(85,"input",40),t()()(),n(86,"div",6)(87,"h3"),r(88,"Informa\xE7\xF5es M\xE9dicas"),t(),n(89,"div",8)(90,"label",41),r(91,"Hist\xF3rico M\xE9dico"),t(),c(92,"textarea",42),t(),n(93,"div",8)(94,"label",43),r(95,"Alergias"),t(),c(96,"textarea",44),t()(),n(97,"div",45)(98,"button",46),r(99,"Cancelar"),t(),n(100,"button",47),r(101),t()()()()),e&2&&(s(4),M(a.isEditMode()?"Editar Paciente":"Novo Paciente"),s(3),v(a.errorMessage()?7:-1),s(),v(a.successMessage()?8:-1),s(),p("formGroup",a.patientForm),s(12),p("readonly",a.isEditMode()),s(5),p("readonly",a.isEditMode()),s(4),p("disabled",a.isEditMode()),s(9),v(a.isChildPatient()?39:-1),s(61),p("disabled",a.patientForm.invalid||a.isLoading()),s(),P(" ",a.isLoading()?"Salvando...":"Salvar"," "))},dependencies:[D,Z,H,J,K,L,$,q,A,Y,U,W,X,j,V,ee],styles:['@charset "UTF-8";.patient-form-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto;padding:var(--spacing-8) var(--spacing-6)}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-8)}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:var(--gray-900);margin:0;font-size:var(--font-size-4xl);font-weight:700}.alert[_ngcontent-%COMP%]{padding:var(--spacing-4);border-radius:var(--radius-lg);margin-bottom:var(--spacing-6);border-left:4px solid}.alert.alert-error[_ngcontent-%COMP%]{background-color:var(--error-50);color:var(--error-700);border-color:var(--error-500)}.alert.alert-success[_ngcontent-%COMP%]{background-color:var(--success-50);color:var(--success-700);border-color:var(--success-500)}.patient-form[_ngcontent-%COMP%]{background:#fff;padding:var(--spacing-8);border-radius:var(--radius-xl);box-shadow:var(--shadow-md);border:1px solid var(--gray-200)}.form-section[_ngcontent-%COMP%]{margin-bottom:var(--spacing-8);padding-bottom:var(--spacing-8);border-bottom:2px solid var(--gray-100)}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none;margin-bottom:0;padding-bottom:0}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--gray-900);margin:0 0 var(--spacing-6) 0;font-size:var(--font-size-2xl);font-weight:600;display:flex;align-items:center;gap:var(--spacing-2)}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:before{content:"\\1f4cb";font-size:var(--font-size-3xl)}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--spacing-5);margin-bottom:var(--spacing-5)}.form-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:var(--spacing-2);color:var(--gray-700);font-weight:600;font-size:var(--font-size-sm)}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;padding:var(--spacing-3) var(--spacing-4);border:2px solid var(--gray-300);border-radius:var(--radius-lg);font-size:var(--font-size-sm);box-sizing:border-box;transition:all var(--transition-base);background-color:#fff}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-500);box-shadow:0 0 0 3px var(--primary-50);transform:translateY(-1px)}.form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:disabled, .form-group[_ngcontent-%COMP%]   .form-control[readonly][_ngcontent-%COMP%]{background-color:var(--gray-100);cursor:not-allowed;border-color:var(--gray-300)}.form-group[_ngcontent-%COMP%]   textarea.form-control[_ngcontent-%COMP%]{resize:vertical;font-family:inherit;min-height:100px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-4);margin-top:var(--spacing-8);padding-top:var(--spacing-8);border-top:2px solid var(--gray-100)}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:var(--spacing-4) var(--spacing-8);border:none;border-radius:var(--radius-lg);font-size:var(--font-size-base);font-weight:600;cursor:pointer;transition:all var(--transition-base);display:inline-flex;align-items:center;gap:var(--spacing-2)}.form-actions[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--primary-600),var(--primary-700));color:#fff;box-shadow:var(--shadow-md)}.form-actions[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,var(--primary-700),var(--primary-800));transform:translateY(-2px);box-shadow:var(--shadow-lg)}.form-actions[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none}.form-actions[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]{background-color:var(--gray-200);color:var(--gray-700);border:1px solid var(--gray-300)}.form-actions[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]:hover{background-color:var(--gray-300)}.btn[_ngcontent-%COMP%]{padding:var(--spacing-3) var(--spacing-6);border:none;border-radius:var(--radius-lg);font-size:var(--font-size-base);font-weight:600;cursor:pointer;transition:all var(--transition-base)}.btn.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--primary-600),var(--primary-700));color:#fff;box-shadow:var(--shadow-md)}.btn.btn-primary[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,var(--primary-700),var(--primary-800));transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn.btn-secondary[_ngcontent-%COMP%]{background-color:var(--gray-200);color:var(--gray-700)}.btn.btn-secondary[_ngcontent-%COMP%]:hover{background-color:var(--gray-300)}.guardian-section[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--info-50),var(--primary-50));padding:var(--spacing-6);border-radius:var(--radius-lg);border:2px solid var(--primary-200)}.guardian-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:before{content:"\\1f468\\200d\\1f469\\200d\\1f467\\200d\\1f466"}.guardian-section[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{grid-column:1/-1}.guardian-section[_ngcontent-%COMP%]   .form-text[_ngcontent-%COMP%]{color:var(--gray-600);font-size:var(--font-size-xs);margin-top:var(--spacing-2);display:block;font-style:italic}.guardian-search[_ngcontent-%COMP%]{position:relative}.guardian-search[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;background:#fff;border:2px solid var(--primary-300);border-top:none;border-radius:0 0 var(--radius-lg) var(--radius-lg);max-height:250px;overflow-y:auto;z-index:1000;box-shadow:var(--shadow-lg)}.guardian-search[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]{padding:var(--spacing-4);cursor:pointer;border-bottom:1px solid var(--gray-100);transition:all var(--transition-fast)}.guardian-search[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]:hover{background-color:var(--primary-50)}.guardian-search[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.guardian-search[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .patient-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-1)}.guardian-search[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .patient-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--gray-900);font-size:var(--font-size-sm);font-weight:600}.guardian-search[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .patient-info[_ngcontent-%COMP%]   .document[_ngcontent-%COMP%], .guardian-search[_ngcontent-%COMP%]   .search-results[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]   .patient-info[_ngcontent-%COMP%]   .age[_ngcontent-%COMP%]{font-size:var(--font-size-xs);color:var(--gray-600)}.guardian-search[_ngcontent-%COMP%]   .selected-guardian[_ngcontent-%COMP%]{margin-top:var(--spacing-4);padding:var(--spacing-4);background-color:var(--success-50);border:2px solid var(--success-200);border-radius:var(--radius-lg);display:flex;justify-content:space-between;align-items:center}.guardian-search[_ngcontent-%COMP%]   .selected-guardian[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--success-700);font-weight:600;margin-right:var(--spacing-2);display:flex;align-items:center;gap:var(--spacing-2)}.guardian-search[_ngcontent-%COMP%]   .selected-guardian[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]:before{content:"\\2713";font-size:var(--font-size-xl)}.guardian-search[_ngcontent-%COMP%]   .selected-guardian[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]{background:none;border:none;color:var(--error-600);font-size:var(--font-size-xl);cursor:pointer;padding:0 var(--spacing-2);line-height:1;transition:all var(--transition-fast);border-radius:var(--radius-md)}.guardian-search[_ngcontent-%COMP%]   .selected-guardian[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]:hover{color:var(--error-700);background-color:var(--error-100)}']})};export{ne as PatientForm};
