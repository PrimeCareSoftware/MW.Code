<app-navbar></app-navbar>

<div class="subdomains-list">
      <div class="header">
        <div>
          <h1>Gerenciar Subdom√≠nios</h1>
          <p class="subtitle">Configure subdom√≠nios para acesso direto das cl√≠nicas</p>
        </div>
        <button class="btn btn-primary" (click)="openCreateModal()">
          <span>‚ûï Novo Subdom√≠nio</span>
        </button>
      </div>

      @if (loading()) {
        <div class="loading">Carregando subdom√≠nios...</div>
      } @else if (error()) {
        <div class="error">{{ error() }}</div>
      } @else {
        <div class="table-container">
          <table class="subdomains-table">
            <thead>
              <tr>
                <th>Subdom√≠nio</th>
                <th>Cl√≠nica</th>
                <th>Tenant ID</th>
                <th>Status</th>
                <th>Criado em</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              @for (subdomain of subdomains(); track subdomain.id) {
                <tr>
                  <td>
                    <code class="subdomain-code">{{ subdomain.subdomain }}.{{ domainSuffix }}</code>
                  </td>
                  <td>{{ subdomain.clinicName }}</td>
                  <td><code>{{ subdomain.tenantId }}</code></td>
                  <td>
                    <span class="status-badge" [class.active]="subdomain.isActive">
                      {{ subdomain.isActive ? '‚úÖ Ativo' : 'üö´ Inativo' }}
                    </span>
                  </td>
                  <td>{{ formatDate(subdomain.createdAt) }}</td>
                  <td>
                    <button class="btn-icon btn-danger" (click)="deleteSubdomain(subdomain.id)" title="Excluir">
                      üóëÔ∏è
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>

          @if (subdomains().length === 0) {
            <div class="empty-state">
              <p>Nenhum subdom√≠nio configurado</p>
            </div>
          }
        </div>
      }

      <!-- Create Modal -->
      @if (showModal) {
        <div class="modal-overlay" (click)="closeModal()">
          <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2>Criar Subdom√≠nio</h2>
              <button class="btn-close" (click)="closeModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
              <p>O subdom√≠nio permite que a cl√≠nica acesse o sistema sem precisar informar o Tenant ID.</p>
              
              <div class="form-group">
                <label>Subdom√≠nio *</label>
                <div class="subdomain-input">
                  <input
                    type="text"
                    [(ngModel)]="formData.subdomain"
                    placeholder="minhaclinica"
                    pattern="[a-z0-9-]+"
                  />
                  <span class="domain-suffix">.{{ domainSuffix }}</span>
                </div>
                <small>Apenas letras min√∫sculas, n√∫meros e h√≠fens</small>
              </div>

              <div class="form-group">
                <label>Cl√≠nica *</label>
                <select [(ngModel)]="formData.clinicId">
                  <option value="">Selecione uma cl√≠nica</option>
                  @for (clinic of clinics(); track clinic.id) {
                    <option [value]="clinic.id">{{ clinic.name }}</option>
                  }
                </select>
              </div>

              @if (modalError()) {
                <div class="error-message">{{ modalError() }}</div>
              }
            </div>

            <div class="modal-footer">
              <button class="btn btn-secondary" (click)="closeModal()">
                Cancelar
              </button>
              <button class="btn btn-primary" (click)="createSubdomain()" [disabled]="!isFormValid() || submitting()">
                @if (submitting()) {
                  <span>Criando...</span>
                } @else {
                  <span>Criar</span>
                }
              </button>
            </div>
          </div>
        </div>
      }
    </div>
