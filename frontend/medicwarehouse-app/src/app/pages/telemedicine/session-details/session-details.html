

<div class="page-container">
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Carregando detalhes...</p>
    </div>
  } @else if (errorMessage()) {
    <div class="alert alert-error">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
      {{ errorMessage() }}
    </div>
  } @else if (session()) {
    <div class="page-header">
      <div>
        <div class="breadcrumb">
          <a routerLink="/telemedicine">Telemedicina</a>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
          <span>Detalhes da Sessão</span>
        </div>
        <h1 class="page-title">Detalhes da Sessão</h1>
      </div>
      <div class="page-actions">
        @if (canStartSession(session()!)) {
          <button (click)="startSession()" class="btn-success">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="5 3 19 12 5 21 5 3"/>
            </svg>
            Iniciar Sessão
          </button>
        }
        @if (canJoinSession(session()!)) {
          <a [routerLink]="['/telemedicine/room', session()!.id]" class="btn-success">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
              <polyline points="17 2 12 7 7 2"></polyline>
            </svg>
            Entrar na Sala
          </a>
        }
        @if (canCancelSession(session()!)) {
          <button (click)="cancelSession()" class="btn-danger">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
            Cancelar
          </button>
        }
      </div>
    </div>

    <div class="details-grid">
      <div class="details-card">
        <div class="card-header">
          <h2 class="card-title">Informações da Sessão</h2>
          <span class="badge" [ngClass]="getStatusBadgeClass(session()!.status)">
            {{ getStatusLabel(session()!.status) }}
          </span>
        </div>
        
        <div class="details-list">
          <div class="detail-row">
            <span class="detail-label">ID da Sessão:</span>
            <span class="detail-value">{{ session()!.id }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">ID do Agendamento:</span>
            <span class="detail-value">{{ session()!.appointmentId }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Criado em:</span>
            <span class="detail-value">{{ formatDateTime(session()!.createdAt) }}</span>
          </div>
          
          @if (session()!.startedAt) {
            <div class="detail-row">
              <span class="detail-label">Iniciado em:</span>
              <span class="detail-value">{{ formatDateTime(session()!.startedAt) }}</span>
            </div>
          }
          
          @if (session()!.completedAt) {
            <div class="detail-row">
              <span class="detail-label">Concluído em:</span>
              <span class="detail-value">{{ formatDateTime(session()!.completedAt) }}</span>
            </div>
          }
          
          @if (session()!.durationMinutes) {
            <div class="detail-row">
              <span class="detail-label">Duração:</span>
              <span class="detail-value">{{ session()!.durationMinutes }} minutos</span>
            </div>
          }
        </div>
      </div>

      <div class="details-card">
        <div class="card-header">
          <h2 class="card-title">Participantes</h2>
        </div>
        
        <div class="details-list">
          <div class="detail-row">
            <span class="detail-label">ID do Profissional:</span>
            <span class="detail-value">{{ session()!.providerId }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">ID do Paciente:</span>
            <span class="detail-value">{{ session()!.patientId }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">ID da Clínica:</span>
            <span class="detail-value">{{ session()!.clinicId }}</span>
          </div>
        </div>
      </div>

      <div class="details-card full-width">
        <div class="card-header">
          <h2 class="card-title">Sala de Vídeo</h2>
        </div>
        
        <div class="details-list">
          <div class="detail-row">
            <span class="detail-label">ID da Sala:</span>
            <span class="detail-value">{{ session()!.roomId }}</span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">URL da Sala:</span>
            <span class="detail-value url-value">
              <a [href]="session()!.roomUrl" target="_blank" class="url-link">
                {{ session()!.roomUrl }}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                  <polyline points="15 3 21 3 21 9"/>
                  <line x1="10" y1="14" x2="21" y2="3"/>
                </svg>
              </a>
            </span>
          </div>
          
          @if (session()!.recordingUrl) {
            <div class="detail-row">
              <span class="detail-label">Gravação:</span>
              <span class="detail-value url-value">
                <a [href]="session()!.recordingUrl" target="_blank" class="url-link">
                  Acessar gravação
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                    <polyline points="15 3 21 3 21 9"/>
                    <line x1="10" y1="14" x2="21" y2="3"/>
                  </svg>
                </a>
              </span>
            </div>
          }
        </div>
      </div>

      @if (session()!.sessionNotes) {
        <div class="details-card full-width">
          <div class="card-header">
            <h2 class="card-title">Notas da Sessão</h2>
          </div>
          
          <div class="notes-content">
            {{ session()!.sessionNotes }}
          </div>
        </div>
      }
    </div>
  }
</div>
