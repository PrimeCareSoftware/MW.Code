<app-navbar></app-navbar>

<div class="attendance-container">
  <div class="page-header">
    <div>
      <h1>Atendimento ao Paciente</h1>
      <p>Registro de consulta e prontu√°rio m√©dico</p>
    </div>
    <button class="btn btn-secondary" routerLink="/appointments">Voltar para Agenda</button>
  </div>

  @if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  }
  @if (warningMessage()) {
    <div class="alert alert-warning" style="white-space: pre-line;">{{ warningMessage() }}</div>
  }
  @if (successMessage()) {
    <div class="alert alert-success">{{ successMessage() }}</div>
  }

  @if (isLoading()) {
    <div class="loading">Carregando...</div>
  } @else {
    <div class="attendance-layout">
      <!-- Left Panel - Patient Info and Timer -->
      <div class="left-panel">
        <!-- Patient Info Card -->
        <div class="card patient-info">
          <h3>Informa√ß√µes do Paciente</h3>
          @if (patient()) {
            <div class="patient-details">
              <div class="detail-row">
                <span class="label">Nome:</span>
                <span class="value">{{ patient()!.name }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Idade:</span>
                <span class="value">{{ patient()!.age }} anos</span>
              </div>
              <div class="detail-row">
                <span class="label">CPF:</span>
                <span class="value">{{ patient()!.document }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Telefone:</span>
                <span class="value">{{ patient()!.phone }}</span>
              </div>
              @if (patient()!.allergies) {
                <div class="detail-row highlight">
                  <span class="label">Alergias:</span>
                  <span class="value">{{ patient()!.allergies }}</span>
                </div>
              }
              @if (appointment()) {
                <div class="detail-row" [class.highlight]="!appointment()!.isPaid">
                  <span class="label">Status de Pagamento:</span>
                  <span class="value">
                    @if (appointment()!.isPaid) {
                      <span class="badge badge-success">‚úì Pago</span>
                      @if (appointment()!.paymentReceivedBy) {
                        <small>({{ appointment()!.paymentReceivedBy }})</small>
                      }
                    } @else {
                      <span class="badge badge-warning">‚ö†Ô∏è Pendente</span>
                    }
                  </span>
                </div>
              }
            </div>
          } @else {
            <p class="text-muted">Carregando informa√ß√µes do paciente...</p>
          }
          
          <!-- Payment Action Button -->
          @if (appointment() && !appointment()!.isPaid) {
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" (click)="showPaymentDialog.set(true)">
              Registrar Pagamento
            </button>
          }
        </div>

        <!-- Timer Card -->
        <div class="card timer-card">
          <h3>Tempo de Consulta</h3>
          <div class="timer-display">
            {{ formatTime(elapsedSeconds()) }}
          </div>
          <p class="timer-info">
            @if (medicalRecord()?.consultationEndTime) {
              Consulta finalizada
            } @else {
              Consulta em andamento
            }
          </p>
        </div>

        <!-- Patient History Card -->
        <div class="card patient-history">
          <h3>Hist√≥rico de Consultas</h3>
          @if (patientHistory().length > 0) {
            <div class="history-list">
              @for (record of patientHistory(); track record.id) {
                <div class="history-item">
                  <div class="history-date">
                    {{ record.consultationStartTime | date: 'dd/MM/yyyy' }}
                  </div>
                  <div class="history-info">
                    <p><strong>Diagn√≥stico:</strong> {{ record.diagnosis || 'N/A' }}</p>
                    <p><strong>Dura√ß√£o:</strong> {{ record.consultationDurationMinutes }} min</p>
                  </div>
                </div>
              }
            </div>
          } @else {
            <p class="text-muted">Nenhum hist√≥rico de consultas</p>
          }
        </div>
      </div>

      <!-- Right Panel - Medical Record Form -->
      <div class="right-panel">
        <form [formGroup]="attendanceForm" class="medical-record-form">
          <!-- CFM 1.821 - Anamnese (Required Fields) -->
          <div class="card">
            <h3>Anamnese - CFM 1.821 @if (formConfig()?.requireChiefComplaint || formConfig()?.requireHistoryOfPresentIllness) { <span class="required-badge">Obrigat√≥rio</span> }</h3>
            
            <div class="form-group">
              <label for="chiefComplaint">Queixa Principal @if (formConfig()?.requireChiefComplaint) { <span class="required">*</span> }</label>
              <textarea 
                id="chiefComplaint" 
                formControlName="chiefComplaint" 
                class="form-control"
                rows="2"
                placeholder="Descreva a queixa principal do paciente (m√≠nimo 10 caracteres)..."
              ></textarea>
              @if (attendanceForm.get('chiefComplaint')?.invalid && attendanceForm.get('chiefComplaint')?.touched) {
                <div class="error-message">Queixa principal √© obrigat√≥ria (m√≠nimo 10 caracteres)</div>
              }
            </div>

            <div class="form-group">
              <label for="historyOfPresentIllness">Hist√≥ria da Doen√ßa Atual (HDA) @if (formConfig()?.requireHistoryOfPresentIllness) { <span class="required">*</span> }</label>
              <textarea 
                id="historyOfPresentIllness" 
                formControlName="historyOfPresentIllness" 
                class="form-control"
                rows="4"
                placeholder="Descreva a hist√≥ria da doen√ßa atual do paciente (m√≠nimo 50 caracteres)..."
              ></textarea>
              @if (attendanceForm.get('historyOfPresentIllness')?.invalid && attendanceForm.get('historyOfPresentIllness')?.touched) {
                <div class="error-message">Hist√≥ria da doen√ßa atual √© obrigat√≥ria (m√≠nimo 50 caracteres)</div>
              }
            </div>

            <div class="form-group">
              <label for="pastMedicalHistory">Hist√≥ria Patol√≥gica Pregressa (HPP)</label>
              <textarea 
                id="pastMedicalHistory" 
                formControlName="pastMedicalHistory" 
                class="form-control"
                rows="3"
                placeholder="Doen√ßas anteriores, cirurgias, interna√ß√µes..."
              ></textarea>
            </div>

            <div class="form-group">
              <label for="familyHistory">Hist√≥ria Familiar</label>
              <textarea 
                id="familyHistory" 
                formControlName="familyHistory" 
                class="form-control"
                rows="2"
                placeholder="Hist√≥rico de doen√ßas na fam√≠lia..."
              ></textarea>
            </div>

            <div class="form-group">
              <label for="lifestyleHabits">H√°bitos de Vida</label>
              <textarea 
                id="lifestyleHabits" 
                formControlName="lifestyleHabits" 
                class="form-control"
                rows="2"
                placeholder="Tabagismo, etilismo, atividade f√≠sica, alimenta√ß√£o..."
              ></textarea>
            </div>

            <div class="form-group">
              <label for="currentMedications">Medica√ß√µes em Uso</label>
              <textarea 
                id="currentMedications" 
                formControlName="currentMedications" 
                class="form-control"
                rows="2"
                placeholder="Medicamentos que o paciente est√° utilizando atualmente..."
              ></textarea>
            </div>
          </div>

          <!-- CFM 1.821 - Clinical Examination -->
          <div class="card">
            <div class="card-header-flex">
              <h3>Exame Cl√≠nico - CFM 1.821 @if (formConfig()?.requireClinicalExamination) { <span class="required-badge">Obrigat√≥rio</span> }</h3>
            </div>
            
            @if (medicalRecord()?.id) {
              <app-clinical-examination-form 
                [medicalRecordId]="medicalRecord()!.id"
                (examinationSaved)="onClinicalExaminationSaved($event)"
              ></app-clinical-examination-form>
            } @else {
              <p class="text-muted">
                ‚ö†Ô∏è Salve o prontu√°rio primeiro para registrar o exame cl√≠nico.
              </p>
            }
          </div>

          <!-- CFM 1.821 - Diagnostic Hypotheses -->
          <div class="card">
            <div class="card-header-flex">
              <h3>Hip√≥teses Diagn√≥sticas - CFM 1.821 @if (formConfig()?.requireDiagnosticHypothesis) { <span class="required-badge">Obrigat√≥rio</span> }</h3>
            </div>

            @if (medicalRecord()?.id) {
              <app-diagnostic-hypothesis-form 
                [medicalRecordId]="medicalRecord()!.id"
                (hypothesisSaved)="onDiagnosticHypothesisSaved($event)"
                (hypothesisDeleted)="onDiagnosticHypothesisDeleted($event)"
              ></app-diagnostic-hypothesis-form>
            } @else {
              <p class="text-muted">
                ‚ö†Ô∏è Salve o prontu√°rio primeiro para registrar hip√≥teses diagn√≥sticas.
              </p>
            }
          </div>

          <!-- CFM 1.821 - Informed Consent -->
          <div class="card">
            <div class="card-header-flex">
              <h3>Consentimento Informado - CFM 1.821 @if (formConfig()?.requireInformedConsent) { <span class="required-badge">Obrigat√≥rio</span> }</h3>
            </div>
            
            @if (medicalRecord()?.id && patient()?.id) {
              <app-informed-consent-form 
                [medicalRecordId]="medicalRecord()!.id"
                [patientId]="patient()!.id"
                (consentCreated)="onConsentCreated($event)"
              ></app-informed-consent-form>
            } @else {
              <p class="text-muted">
                ‚ö†Ô∏è Salve o prontu√°rio primeiro para registrar o consentimento informado.
              </p>
            }
          </div>

          <!-- CFM 1.821 - Therapeutic Plan -->
          <div class="card">
            <div class="card-header-flex">
              <h3>Plano Terap√™utico - CFM 1.821 @if (formConfig()?.requireTherapeuticPlan) { <span class="required-badge">Obrigat√≥rio</span> }</h3>
            </div>

            @if (medicalRecord()?.id) {
              <app-therapeutic-plan-form 
                [medicalRecordId]="medicalRecord()!.id"
                (planSaved)="onTherapeuticPlanSaved($event)"
              ></app-therapeutic-plan-form>
            } @else {
              <p class="text-muted">
                ‚ö†Ô∏è Salve o prontu√°rio primeiro para registrar o plano terap√™utico.
              </p>
            }
          </div>

          <!-- Legacy Fields (Optional - kept for backward compatibility) -->
          <div class="card legacy-fields">
            <h3>Campos Adicionais (Opcional)</h3>
            <p class="info-text">Estes campos s√£o mantidos para compatibilidade, mas os campos CFM 1.821 acima s√£o obrigat√≥rios.</p>
            
            <div class="form-group">
              <app-rich-text-editor
                formControlName="diagnosis"
                id="diagnosis"
                label="Diagn√≥stico (Legacy)"
                placeholder="Campo legado - use Hip√≥teses Diagn√≥sticas CFM acima"
                [rows]="3"
                [enableMedicationAutocomplete]="false"
                [enableExamAutocomplete]="false"
              ></app-rich-text-editor>
            </div>

            <div class="form-group">
              <app-rich-text-editor
                formControlName="prescription"
                id="prescription"
                label="Prescri√ß√£o M√©dica (Legacy)"
                placeholder="Campo legado - use Plano Terap√™utico CFM acima"
                [rows]="4"
                [enableMedicationAutocomplete]="true"
                [enableExamAutocomplete]="false"
                (medicationSelected)="onMedicationSelected($event)"
              ></app-rich-text-editor>
              <button type="button" class="btn btn-outline btn-print" (click)="onPrint()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 6 2 18 2 18 9"></polyline>
                  <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                  <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
                Imprimir Receita
              </button>
            </div>

            <div class="form-group">
              <app-rich-text-editor
                formControlName="notes"
                id="notes"
                label="Observa√ß√µes Cl√≠nicas (Legacy)"
                placeholder="Campo legado para anota√ß√µes adicionais"
                [rows]="3"
                [enableMedicationAutocomplete]="true"
                [enableExamAutocomplete]="true"
                (medicationSelected)="onMedicationSelected($event)"
                (examSelected)="onExamSelected($event)"
              ></app-rich-text-editor>
            </div>
          </div>

          <!-- Procedures Section -->
          <div class="card">
            <div class="card-header-flex">
              <h3>Procedimentos Realizados</h3>
              <button type="button" class="btn btn-outline" (click)="toggleAddProcedure()">
                {{ showAddProcedure() ? 'Cancelar' : '+ Adicionar Procedimento' }}
              </button>
            </div>
            
            @if (showAddProcedure()) {
              <form [formGroup]="procedureForm" class="add-form">
                <div class="form-group">
                  <label for="procedure">Procedimento</label>
                  <select id="procedure" formControlName="procedureId" class="form-control">
                    <option value="">Selecione um procedimento</option>
                    @for (proc of availableProcedures(); track proc.id) {
                      <option [value]="proc.id">{{ proc.name }} - R$ {{ proc.price }}</option>
                    }
                  </select>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="customPrice">Pre√ßo Personalizado (opcional)</label>
                    <input 
                      type="number" 
                      id="customPrice" 
                      formControlName="customPrice" 
                      class="form-control" 
                      placeholder="Deixe vazio para usar pre√ßo padr√£o"
                      step="0.01"
                    />
                  </div>
                  <div class="form-group">
                    <label for="procedureNotes">Observa√ß√µes</label>
                    <input 
                      type="text" 
                      id="procedureNotes" 
                      formControlName="notes" 
                      class="form-control" 
                      placeholder="Observa√ß√µes sobre o procedimento"
                    />
                  </div>
                </div>
                <button type="button" class="btn btn-primary" (click)="onAddProcedure()" [disabled]="!procedureForm.valid">
                  Adicionar
                </button>
              </form>
            }

            @if (appointmentProcedures().length > 0) {
              <div class="procedures-list">
                @for (proc of appointmentProcedures(); track proc.id) {
                  <div class="procedure-item">
                    <div class="procedure-info">
                      <strong>{{ proc.procedureName }}</strong>
                      <span class="procedure-code">{{ proc.procedureCode }}</span>
                    </div>
                    <div class="procedure-price">R$ {{ proc.priceCharged }}</div>
                    @if (proc.notes) {
                      <div class="procedure-notes">{{ proc.notes }}</div>
                    }
                  </div>
                }
                <div class="procedures-total">
                  <strong>Total:</strong> <span>R$ {{ getTotalProceduresCost() }}</span>
                </div>
              </div>
            } @else {
              <p class="text-muted">Nenhum procedimento adicionado</p>
            }
          </div>

          <!-- Exam Requests Section -->
          <div class="card">
            <div class="card-header-flex">
              <h3>Pedidos de Exames</h3>
              <button type="button" class="btn btn-outline" (click)="toggleAddExam()">
                {{ showAddExam() ? 'Cancelar' : '+ Solicitar Exame' }}
              </button>
            </div>
            
            @if (showAddExam()) {
              <form [formGroup]="examForm" class="add-form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="examType">Tipo de Exame</label>
                    <select id="examType" formControlName="examType" class="form-control">
                      @for (type of examTypes; track type) {
                        <option [value]="type">{{ examTypeLabels[type] }}</option>
                      }
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="urgency">Urg√™ncia</label>
                    <select id="urgency" formControlName="urgency" class="form-control">
                      @for (urgency of examUrgencies; track urgency) {
                        <option [value]="urgency">{{ examUrgencyLabels[urgency] }}</option>
                      }
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="examName">Nome do Exame</label>
                  <input 
                    type="text" 
                    id="examName" 
                    formControlName="examName" 
                    class="form-control" 
                    placeholder="Ex: Hemograma Completo, Raio-X de T√≥rax"
                  />
                </div>
                <div class="form-group">
                  <label for="description">Descri√ß√£o / Justificativa</label>
                  <textarea 
                    id="description" 
                    formControlName="description" 
                    class="form-control" 
                    rows="2"
                    placeholder="Motivo da solicita√ß√£o do exame..."
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="examNotes">Observa√ß√µes Adicionais</label>
                  <input 
                    type="text" 
                    id="examNotes" 
                    formControlName="notes" 
                    class="form-control" 
                    placeholder="Instru√ß√µes especiais, preparo, etc."
                  />
                </div>
                <button type="button" class="btn btn-primary" (click)="onAddExamRequest()" [disabled]="!examForm.valid">
                  Adicionar Pedido
                </button>
              </form>
            }

            @if (examRequests().length > 0) {
              <div class="exams-list">
                @for (exam of examRequests(); track exam.id) {
                  <div class="exam-item">
                    <div class="exam-header">
                      <strong>{{ exam.examName }}</strong>
                      <span class="exam-type-badge">{{ examTypeLabels[exam.examType] }}</span>
                      <span class="exam-urgency-badge urgency-{{ exam.urgency }}">{{ examUrgencyLabels[exam.urgency] }}</span>
                      <button type="button" class="btn-remove" (click)="removeExamRequest(exam)" title="Remover">
                        ‚úï
                      </button>
                    </div>
                    <div class="exam-description">{{ exam.description }}</div>
                    @if (exam.notes) {
                      <div class="exam-notes"><em>Obs: {{ exam.notes }}</em></div>
                    }
                  </div>
                }
              </div>
            } @else {
              <p class="text-muted">Nenhum pedido de exame adicionado</p>
            }
          </div>

          <!-- Digital Prescriptions Section - CFM 1.643/2002 + ANVISA -->
          <div class="card">
            <div class="card-header-flex">
              <h3>Receitas M√©dicas Digitais - CFM 1.643/2002 + ANVISA</h3>
              @if (medicalRecord()?.id) {
                <button 
                  type="button" 
                  class="btn btn-primary" 
                  [routerLink]="['/prescriptions/new', medicalRecord()!.id]"
                  title="Criar nova receita digital conforme CFM e ANVISA"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="12" y1="18" x2="12" y2="12"></line>
                    <line x1="9" y1="15" x2="15" y2="15"></line>
                  </svg>
                  Nova Receita Digital
                </button>
              }
            </div>
            <div class="prescription-info">
              <p class="info-text">
                <strong>Sistema de Receitas Digitais:</strong> Crie receitas em conformidade com CFM 1.643/2002 e ANVISA 344/1998.
                Suporta receitas simples, controladas (A, B, C1) e antimicrobianas com rastreamento SNGPC.
              </p>
              @if (!medicalRecord()?.id) {
                <p class="text-warning">
                  ‚ö†Ô∏è Salve o prontu√°rio primeiro para habilitar a cria√ß√£o de receitas digitais.
                </p>
              }
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="onSave()" [disabled]="isLoading()">
              üíæ Salvar Prontu√°rio
            </button>
            
            @if (!medicalRecord()?.consultationEndTime) {
              <!-- Show payment option checkbox if appointment is not paid yet -->
              @if (appointment() && !appointment()!.isPaid) {
                <div class="form-check mt-2 mb-2">
                  <input 
                    type="checkbox" 
                    class="form-check-input" 
                    id="registerPayment"
                    [checked]="registerPaymentOnComplete()"
                    (change)="togglePaymentRegistration()">
                  <label class="form-check-label" for="registerPayment">
                    Registrar que recebi o pagamento
                  </label>
                </div>
              }
              
              <!-- CFM 1.821 Compliance Status -->
              @if (cfm1821Status()) {
                <div class="cfm1821-status mt-3 mb-3" [class.compliant]="cfm1821IsCompliant()" [class.non-compliant]="!cfm1821IsCompliant()">
                  <div class="status-header">
                    <strong>CFM 1.821 - Conformidade:</strong>
                    <span class="badge" [class.bg-success]="cfm1821IsCompliant()" [class.bg-warning]="!cfm1821IsCompliant()">
                      {{ cfm1821CompletenessPercentage() }}% Completo
                    </span>
                  </div>
                  @if (!cfm1821IsCompliant() && cfm1821MissingRequirements().length > 0) {
                    <div class="missing-requirements">
                      <p><strong>Campos obrigat√≥rios faltando:</strong></p>
                      <ul>
                        @for (req of cfm1821MissingRequirements(); track req) {
                          <li>{{ req }}</li>
                        }
                      </ul>
                    </div>
                  }
                  @if (cfm1821IsCompliant()) {
                    <div class="compliance-ok">
                      ‚úì Todos os campos obrigat√≥rios CFM 1.821 preenchidos
                    </div>
                  }
                </div>
              }
              
              <button type="button" class="btn btn-secondary" (click)="callNextPatient()" [disabled]="isLoading()" style="margin-right: 1rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
                Chamar Pr√≥ximo Paciente
              </button>
              
              <button type="button" class="btn btn-info" (click)="checkCfm1821Compliance()" [disabled]="isLoading()" style="margin-right: 1rem;">
                üîç Verificar Conformidade CFM 1.821
              </button>
              
              <button type="button" class="btn btn-primary" (click)="onComplete()" [disabled]="isLoading() || !cfm1821IsCompliant()">
                ‚úì Finalizar Atendimento
              </button>
            } @else {
              <div class="completion-notice">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                  <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                Atendimento Finalizado
              </div>
            }
          </div>
        </form>
      </div>
    </div>
  }
</div>

<!-- Payment Dialog -->
@if (showPaymentDialog()) {
  <div class="modal-overlay" (click)="showPaymentDialog.set(false)">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Registrar Pagamento</h3>
        <button type="button" class="btn-close" (click)="showPaymentDialog.set(false)">√ó</button>
      </div>
      <div class="modal-body">
        <p>Quem est√° recebendo o pagamento desta consulta?</p>
        <div class="payment-options">
          <button type="button" class="btn btn-outline-primary btn-block" (click)="markAppointmentAsPaid('Doctor')">
            üë®‚Äç‚öïÔ∏è M√©dico
          </button>
          <button type="button" class="btn btn-outline-primary btn-block" (click)="markAppointmentAsPaid('Secretary')">
            üíº Secret√°ria/Recep√ß√£o
          </button>
          <button type="button" class="btn btn-outline-primary btn-block" (click)="markAppointmentAsPaid('Other')">
            üë§ Outro Funcion√°rio
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Print-only section -->
<div class="print-only">
  @if (patient() && medicalRecord()) {
    <div class="prescription-print">
      <h2>Prescri√ß√£o M√©dica</h2>
      <div class="prescription-header">
        <p><strong>Paciente:</strong> {{ patient()!.name }}</p>
        <p><strong>Data:</strong> {{ medicalRecord()!.consultationStartTime | date: 'dd/MM/yyyy HH:mm' }}</p>
      </div>
      <div class="prescription-content">
        {{ attendanceForm.get('prescription')?.value }}
      </div>
    </div>
  }
</div>

<!-- Notification Modal for Call Next Patient -->
<app-notification-modal #notificationModal (confirmed)="onNotificationConfirmed($event)"></app-notification-modal>
<app-help-button module="attendance"></app-help-button>
