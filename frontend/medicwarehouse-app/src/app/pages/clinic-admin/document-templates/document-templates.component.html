<app-navbar></app-navbar>
<div class="document-templates-container">
  <div class="page-header">
    <h1>Templates de ImpressÃ£o</h1>
    <p class="subtitle">Gerencie templates para prontuÃ¡rios, atestados, receitas e outros documentos</p>
  </div>

  <!-- Notifications -->
  <div *ngIf="error" class="notification error">
    <span class="icon">âš ï¸</span>
    <span>{{ error }}</span>
    <button class="close-btn" (click)="error = null">Ã—</button>
  </div>

  <div *ngIf="success" class="notification success">
    <span class="icon">âœ“</span>
    <span>{{ success }}</span>
    <button class="close-btn" (click)="success = null">Ã—</button>
  </div>

  <!-- Filters and Actions -->
  <div class="toolbar">
    <div class="filters">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Buscar templates..."
        [(ngModel)]="searchText"
        (ngModelChange)="applyFilters()"
      />
      
      <select 
        class="filter-select" 
        [(ngModel)]="filterSpecialty"
        (ngModelChange)="applyFilters()"
      >
        <option [ngValue]="null">Todas as especialidades</option>
        <option *ngFor="let spec of specialties" [ngValue]="spec.value">
          {{ spec.label }}
        </option>
      </select>
      
      <select 
        class="filter-select" 
        [(ngModel)]="filterType"
        (ngModelChange)="applyFilters()"
      >
        <option [ngValue]="null">Todos os tipos</option>
        <option *ngFor="let type of templateTypes" [ngValue]="type.value">
          {{ type.label }}
        </option>
      </select>
      
      <select 
        class="filter-select" 
        [(ngModel)]="filterActive"
        (ngModelChange)="applyFilters()"
      >
        <option [ngValue]="null">Todos os status</option>
        <option [ngValue]="true">Ativos</option>
        <option [ngValue]="false">Inativos</option>
      </select>
      
      <button class="btn btn-link" (click)="clearFilters()" type="button">
        Limpar filtros
      </button>
    </div>

    <div class="action-buttons">
      <button class="btn btn-secondary" (click)="toggleGlobalTemplates()" type="button">
        {{ showGlobalTemplates ? 'ğŸ“‹ Ocultar Templates Globais' : 'ğŸŒ Mostrar Templates Globais' }}
      </button>
      <button class="btn btn-primary" (click)="createNew()" type="button">
        â• Novo Template
      </button>
    </div>
  </div>

  <!-- Global Templates Section -->
  <div *ngIf="showGlobalTemplates" class="global-templates-section">
    <div class="section-header">
      <h2>ğŸŒ Templates Globais DisponÃ­veis</h2>
      <p class="section-subtitle">Utilize templates prÃ©-configurados como base para criar seus prÃ³prios templates</p>
    </div>

    <!-- Loading State for Global Templates -->
    <div *ngIf="loadingGlobal" class="loading-container">
      <div class="spinner"></div>
      <p>Carregando templates globais...</p>
    </div>

    <!-- Global Templates Grid -->
    <div *ngIf="!loadingGlobal" class="templates-grid">
      <div *ngIf="filteredGlobalTemplates.length === 0" class="empty-state">
        <p class="empty-icon">ğŸŒ</p>
        <h3>Nenhum template global encontrado</h3>
        <p>NÃ£o hÃ¡ templates globais disponÃ­veis no momento</p>
      </div>

      <div 
        *ngFor="let template of filteredGlobalTemplates" 
        class="template-card global-template"
      >
        <div class="card-header">
          <div class="card-title-section">
            <h3 class="card-title">{{ template.name }}</h3>
            <span class="badge badge-global">ğŸŒ Global</span>
          </div>
        </div>

        <p class="card-description">{{ template.description || 'Sem descriÃ§Ã£o' }}</p>

        <div class="card-meta">
          <div class="meta-item">
            <span class="meta-label">Especialidade:</span>
            <span class="meta-value">{{ getSpecialtyLabel(template.specialty) }}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Tipo:</span>
            <span class="meta-value">{{ getTypeLabel(template.type) }}</span>
          </div>
        </div>

        <div class="card-footer">
          <button 
            class="btn btn-primary btn-use-template" 
            (click)="useGlobalTemplate(template)"
            type="button"
          >
            âœ¨ Usar como Base
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Divider -->
  <div *ngIf="showGlobalTemplates" class="section-divider">
    <h2>ğŸ“‹ Seus Templates</h2>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Carregando templates...</p>
  </div>

  <!-- Templates Grid -->
  <div *ngIf="!loading" class="templates-grid">
    <div *ngIf="filteredTemplates.length === 0" class="empty-state">
      <p class="empty-icon">ğŸ“„</p>
      <h3>Nenhum template encontrado</h3>
      <p>Crie um novo template ou ajuste os filtros</p>
      <button class="btn btn-primary" (click)="createNew()" type="button">
        Criar Primeiro Template
      </button>
    </div>

    <div 
      *ngFor="let template of filteredTemplates" 
      class="template-card"
      [class.inactive]="!template.isActive"
      [class.system]="template.isSystem"
      (click)="viewTemplate(template.id)"
    >
      <div class="card-header">
        <div class="card-title-section">
          <h3 class="card-title">{{ template.name }}</h3>
          <span class="badge" [class.badge-system]="template.isSystem" [class.badge-custom]="!template.isSystem">
            {{ template.isSystem ? 'Sistema' : 'Personalizado' }}
          </span>
        </div>
        <div class="card-actions" (click)="$event.stopPropagation()">
          <button 
            class="btn-icon"
            [class.active]="template.isActive"
            [class.inactive]="!template.isActive"
            (click)="toggleActive(template, $event)"
            [title]="template.isActive ? 'Desativar' : 'Ativar'"
            type="button"
          >
            {{ template.isActive ? 'âœ“' : 'â—‹' }}
          </button>
          <button 
            class="btn-icon"
            (click)="editTemplate(template.id); $event.stopPropagation()"
            title="Editar"
            type="button"
          >
            âœï¸
          </button>
          <button 
            *ngIf="!template.isSystem"
            class="btn-icon btn-danger"
            (click)="deleteTemplate(template, $event)"
            title="Excluir"
            type="button"
          >
            ğŸ—‘ï¸
          </button>
        </div>
      </div>

      <p class="card-description">{{ template.description || 'Sem descriÃ§Ã£o' }}</p>

      <div class="card-meta">
        <div class="meta-item">
          <span class="meta-label">Especialidade:</span>
          <span class="meta-value">{{ getSpecialtyLabel(template.specialty) }}</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Tipo:</span>
          <span class="meta-value">{{ getTypeLabel(template.type) }}</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Status:</span>
          <span class="meta-value" [class.active-text]="template.isActive" [class.inactive-text]="!template.isActive">
            {{ template.isActive ? 'Ativo' : 'Inativo' }}
          </span>
        </div>
      </div>

      <div class="card-footer">
        <small>Criado em: {{ template.createdAt | date:'dd/MM/yyyy HH:mm' }}</small>
        <small *ngIf="template.updatedAt">Atualizado: {{ template.updatedAt | date:'dd/MM/yyyy HH:mm' }}</small>
      </div>
    </div>
  </div>
</div>
