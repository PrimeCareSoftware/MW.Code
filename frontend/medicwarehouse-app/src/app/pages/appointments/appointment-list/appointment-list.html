<app-navbar></app-navbar>

<div class="appointment-list-container">
  <div class="page-header">
    <div>
      <h1>Agendamentos</h1>
      <p>Agenda diária de consultas</p>
    </div>
    <button class="btn btn-primary" routerLink="/appointments/new">
      + Novo Agendamento
    </button>
  </div>

  <div class="date-selector">
    <label for="date">Selecionar Data:</label>
    <input 
      type="date" 
      id="date" 
      [value]="selectedDate()" 
      (change)="onDateChange($event)"
      class="date-input"
    />
  </div>

  @if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  }

  @if (isLoading()) {
    <div class="loading">Carregando...</div>
  } @else if (agenda()) {
    <div class="agenda-info">
      <h3>{{ agenda()!.clinicName }}</h3>
      <p>{{ agenda()!.appointments.length }} agendamentos</p>
    </div>

    @if (agenda()!.appointments.length === 0) {
      <div class="empty-state">
        <p>Nenhum agendamento para esta data</p>
        <button class="btn btn-primary" routerLink="/appointments/new">
          Criar agendamento
        </button>
      </div>
    } @else {
      <div class="appointments-grid">
        @for (appointment of agenda()!.appointments; track appointment.id) {
          <div class="appointment-card">
            <div class="appointment-time">
              {{ appointment.scheduledTime }}
            </div>
            <div class="appointment-info">
              <h4>{{ appointment.patientName }}</h4>
              <p>{{ appointment.type }} - {{ appointment.durationMinutes }}min</p>
              <span class="status" [class]="'status-' + appointment.status.toLowerCase()">
                {{ appointment.status }}
              </span>
              @if (appointment.notes) {
                <p class="notes">{{ appointment.notes }}</p>
              }
            </div>
            <div class="appointment-actions">
              @if (appointment.status === 'Scheduled' || appointment.status === 'Confirmed') {
                <button class="btn btn-primary btn-sm" [routerLink]="['/appointments', appointment.id, 'attendance']">
                  Iniciar Atendimento
                </button>
              }
              @if (appointment.status === 'InProgress') {
                <button class="btn btn-success btn-sm" [routerLink]="['/appointments', appointment.id, 'attendance']">
                  Continuar Atendimento
                </button>
              }
              @if (appointment.status === 'Completed') {
                <span class="badge badge-completed">Atendimento Concluído</span>
              }
              <button 
                class="btn-cancel" 
                (click)="cancelAppointment(appointment.id)"
                [disabled]="appointment.status === 'Cancelled' || appointment.status === 'Completed'"
              >
                Cancelar
              </button>
            </div>
          </div>
        }
      </div>
    }
  }
</div>
