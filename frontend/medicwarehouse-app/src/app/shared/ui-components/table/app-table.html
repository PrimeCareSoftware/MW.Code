<div class="table-container">
  @if (loading) {
    <div class="table-loading">
      <div class="loading-spinner"></div>
      <span>Carregando...</span>
    </div>
  } @else {
    <table>
      <thead>
        <tr>
          @for (col of columns; track col.key) {
            <th
              [style.width]="col.width"
              [class.sortable]="col.sortable"
              (click)="sort(col)"
            >
              <span class="th-content">
                {{ col.label }}
                @if (col.sortable) {
                  <span class="sort-icon" [class.asc]="sortColumn === col.key && sortDirection === 'asc'" [class.desc]="sortColumn === col.key && sortDirection === 'desc'">
                    <svg width="10" height="10" viewBox="0 0 10 10" fill="currentColor">
                      <path d="M5 2L8 6H2L5 2Z"/>
                    </svg>
                    <svg width="10" height="10" viewBox="0 0 10 10" fill="currentColor" style="transform: rotate(180deg)">
                      <path d="M5 2L8 6H2L5 2Z"/>
                    </svg>
                  </span>
                }
              </span>
            </th>
          }
        </tr>
      </thead>
      <tbody>
        @if (pagedData.length === 0) {
          <tr>
            <td [attr.colspan]="columns.length" class="table-empty">{{ emptyMessage }}</td>
          </tr>
        } @else {
          @for (row of pagedData; track $index) {
            <tr>
              @for (col of columns; track col.key) {
                <td>
                  @if (getCellTemplate(col.key)) {
                    <ng-container [ngTemplateOutlet]="getCellTemplate(col.key)!" [ngTemplateOutletContext]="{ $implicit: row, value: getCellValue(row, col.key), column: col }"></ng-container>
                  } @else {
                    {{ getCellValue(row, col.key) }}
                  }
                </td>
              }
            </tr>
          }
        }
      </tbody>
    </table>

    @if (showPagination && data.length > 0) {
      <div class="table-pagination">
        <span class="pagination-info">
          Mostrando {{ startIndex }}–{{ endIndex }} de {{ data.length }} registros
        </span>
        <div class="pagination-controls">
          <button class="btn-icon" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)" title="Anterior">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
          </button>
          @for (page of pages; track page) {
            @if (page === 1 || page === totalPages || (page >= currentPage - 1 && page <= currentPage + 1)) {
              <button
                class="page-btn"
                [class.active]="page === currentPage"
                (click)="goToPage(page)"
              >{{ page }}</button>
            } @else if (page === currentPage - 2 || page === currentPage + 2) {
              <span class="page-ellipsis">…</span>
            }
          }
          <button class="btn-icon" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)" title="Próximo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          </button>
        </div>
      </div>
    }
  }
</div>
