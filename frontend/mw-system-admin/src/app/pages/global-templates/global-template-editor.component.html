<div class="editor-container">
  <div class="page-header">
    <h1>{{ isEditMode() ? '‚úèÔ∏è Editar' : '‚ûï Criar' }} Template Global</h1>
    <p class="subtitle">
      {{ isEditMode() ? 'Edite os detalhes do template global' : 'Crie um novo template global para todas as cl√≠nicas' }}
    </p>
  </div>

  <!-- Success/Error Messages -->
  @if (success()) {
    <div class="alert alert-success">
      {{ success() }}
    </div>
  }

  @if (error()) {
    <div class="alert alert-error">
      {{ error() }}
    </div>
  }

  <!-- Form -->
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="editor-layout">
      <!-- Main Form -->
      <div class="main-panel">
        <div class="form-section">
          <h2>Informa√ß√µes B√°sicas</h2>

          <div class="form-group">
            <label for="name">Nome do Template *</label>
            <input
              type="text"
              id="name"
              formControlName="name"
              placeholder="Ex: Receita M√©dica Padr√£o"
              class="form-input"
              [class.input-error]="getFieldError('name')"
            />
            @if (getFieldError('name')) {
              <span class="error-message">{{ getFieldError('name') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="description">Descri√ß√£o *</label>
            <textarea
              id="description"
              formControlName="description"
              placeholder="Descreva o prop√≥sito deste template..."
              rows="3"
              class="form-input"
              [class.input-error]="getFieldError('description')"
            ></textarea>
            @if (getFieldError('description')) {
              <span class="error-message">{{ getFieldError('description') }}</span>
            }
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="type">Tipo de Documento *</label>
              <select
                id="type"
                formControlName="type"
                class="form-input"
                [disabled]="isEditMode()"
                [class.input-error]="getFieldError('type')"
              >
                @for (type of templateTypes; track type.value) {
                  <option [value]="type.value">{{ type.label }}</option>
                }
              </select>
              @if (getFieldError('type')) {
                <span class="error-message">{{ getFieldError('type') }}</span>
              }
            </div>

            <div class="form-group">
              <label for="specialty">Especialidade *</label>
              <select
                id="specialty"
                formControlName="specialty"
                class="form-input"
                [disabled]="isEditMode()"
                [class.input-error]="getFieldError('specialty')"
              >
                @for (specialty of specialties; track specialty.value) {
                  <option [value]="specialty.value">{{ specialty.label }}</option>
                }
              </select>
              @if (getFieldError('specialty')) {
                <span class="error-message">{{ getFieldError('specialty') }}</span>
              }
            </div>
          </div>

          @if (isEditMode()) {
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="isActive" />
                <span>Template ativo</span>
              </label>
            </div>
          }
        </div>

        <div class="form-section">
          <h2>Conte√∫do do Template *</h2>
          <p class="section-hint">
            Use o editor abaixo para criar o conte√∫do do template. Clique nas vari√°veis √† direita para inseri-las.
          </p>

          <div class="editor-wrapper">
            <quill-editor
              formControlName="content"
              [modules]="quillModules"
              placeholder="Digite o conte√∫do do template aqui..."
              class="quill-editor"
            ></quill-editor>
            @if (getFieldError('content')) {
              <span class="error-message">{{ getFieldError('content') }}</span>
            }
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancel()" [disabled]="loading()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="loading() || form.invalid">
            @if (loading()) {
              <span class="spinner-small"></span>
            }
            {{ isEditMode() ? 'Atualizar Template' : 'Criar Template' }}
          </button>
        </div>
      </div>

      <!-- Sidebar with Variables -->
      <div class="sidebar-panel">
        <div class="sidebar-content">
          <h3>üìã Vari√°veis Dispon√≠veis</h3>
          <p class="sidebar-hint">
            Clique em uma vari√°vel para inseri-la no template. As vari√°veis ser√£o substitu√≠das pelos valores reais quando o documento for gerado.
          </p>

          <div class="variables-list">
            @for (variable of availableVariables; track variable.key) {
              <div class="variable-item" (click)="insertVariable(variable)">
                <div class="variable-header">
                  <span class="variable-name">{{ variable.label }}</span>
                  <span class="variable-key">{{"{{" + variable.key + "}}"}}</span>
                </div>
                @if (variable.description) {
                  <p class="variable-desc">{{ variable.description }}</p>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
