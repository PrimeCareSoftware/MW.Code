<div class="subscription-container">
  <div class="page-header">
    <h1>Assinatura e Plano</h1>
    <p>Gerencie sua assinatura e informações de pagamento</p>
  </div>

  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Carregando informações da assinatura...</p>
    </div>
  } @else {
    @if (errorMessage()) {
      <div class="alert alert-error">
        {{ errorMessage() }}
      </div>
    }

    @if (successMessage()) {
      <div class="alert alert-success">
        {{ successMessage() }}
      </div>
    }

    @if (subscription()) {
      <div class="subscription-card">
        <div class="subscription-header">
          <div class="plan-info">
            <h2>{{ subscription()!.planName }}</h2>
            <span [class]="'status-badge ' + getStatusClass(subscription()!.status)">
              {{ getStatusText(subscription()!.status) }}
            </span>
          </div>
        </div>

        <div class="subscription-details">
          <div class="detail-item">
            <label>Data de Início</label>
            <p>{{ subscription()!.startDate | date: 'dd/MM/yyyy' }}</p>
          </div>

          @if (subscription()!.endDate) {
            <div class="detail-item">
              <label>Data de Término</label>
              <p>{{ subscription()!.endDate | date: 'dd/MM/yyyy' }}</p>
            </div>
          }

          @if (subscription()!.maxUsers) {
            <div class="detail-item">
              <label>Usuários</label>
              <p>{{ subscription()!.currentUsers || 0 }} / {{ subscription()!.maxUsers }}</p>
            </div>
          }
        </div>

        @if (subscription()!.features && subscription()!.features!.length > 0) {
          <div class="features-section">
            <h3>Funcionalidades Incluídas</h3>
            <ul class="features-list">
              @for (feature of subscription()!.features; track feature) {
                <li>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                  <span>{{ feature }}</span>
                </li>
              }
            </ul>
          </div>
        }

        @if (subscription()!.status.toLowerCase() === 'active' || subscription()!.status.toLowerCase() === 'ativo') {
          <div class="actions-section">
            <button 
              type="button" 
              class="btn btn-danger" 
              (click)="requestCancellation()"
              [disabled]="isCancelling()"
            >
              Solicitar Cancelamento
            </button>
          </div>
        }
      </div>
    } @else {
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="8" width="18" height="4" rx="1"/>
          <path d="M12 8v13"/>
          <path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/>
          <path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/>
        </svg>
        <h3>Nenhuma assinatura encontrada</h3>
        <p>Entre em contato com o suporte para ativar sua assinatura.</p>
      </div>
    }
  }

  @if (showCancelConfirm()) {
    <div class="modal-overlay" (click)="cancelCancellationRequest()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3>Confirmar Cancelamento</h3>
        <p>Tem certeza que deseja solicitar o cancelamento da sua assinatura?</p>
        <p class="warning-text">Esta ação não pode ser desfeita e você perderá acesso a todas as funcionalidades do sistema.</p>
        
        <div class="modal-actions">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="cancelCancellationRequest()"
          >
            Voltar
          </button>
          <button 
            type="button" 
            class="btn btn-danger" 
            (click)="confirmCancellation()"
            [disabled]="isCancelling()"
          >
            @if (isCancelling()) {
              <span class="spinner"></span>
              <span>Processando...</span>
            } @else {
              <span>Confirmar Cancelamento</span>
            }
          </button>
        </div>
      </div>
    </div>
  }
</div>
