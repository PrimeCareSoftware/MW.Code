

<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>üí∞ Dashboard Financeiro</h1>
      <p>An√°lise de receitas, despesas e indicadores financeiros</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="exportData()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        Exportar
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filter-section">
    <div class="filter-card">
      <div class="filter-group">
        <label>Per√≠odo</label>
        <select [(ngModel)]="dateRange" (change)="onFilterChange()" class="form-select">
          <option value="today">Hoje</option>
          <option value="last7days">√öltimos 7 dias</option>
          <option value="last30days">√öltimos 30 dias</option>
          <option value="thisMonth">Este m√™s</option>
          <option value="lastMonth">M√™s passado</option>
          <option value="last3months">√öltimos 3 meses</option>
          <option value="last6months">√öltimos 6 meses</option>
          <option value="custom">Personalizado</option>
        </select>
      </div>

      @if (dateRange === 'custom') {
        <div class="filter-group">
          <label>Data inicial</label>
          <input 
            type="date" 
            [(ngModel)]="customStartDate" 
            (change)="onFilterChange()"
            class="form-input"
          />
        </div>
        <div class="filter-group">
          <label>Data final</label>
          <input 
            type="date" 
            [(ngModel)]="customEndDate" 
            (change)="onFilterChange()"
            class="form-input"
          />
        </div>
      }
    </div>
  </div>

  <!-- Loading State -->
  @if (loading) {
    <app-loading message="Carregando dashboard financeiro..." size="large"></app-loading>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <div class="error-message">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadDashboard()">Tentar novamente</button>
    </div>
  }

  <!-- Dashboard Content -->
  @if (!loading && dashboard) {
    <!-- Revenue Projection Alert -->
    @if (projecao) {
      <div class="projection-banner">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        <div class="projection-content">
          <span class="projection-label">Proje√ß√£o para {{ projecao.mes }}</span>
          <span class="projection-value">{{ formatCurrency(projecao.projecao) }}</span>
        </div>
      </div>
    }

    <!-- KPI Cards -->
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-icon blue">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">Receita Total</span>
          <span class="kpi-value">{{ formatCurrency(dashboard.receitaTotal) }}</span>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon green">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">Recebida</span>
          <span class="kpi-value">{{ formatCurrency(dashboard.receitaRecebida) }}</span>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon orange">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">Pendente</span>
          <span class="kpi-value">{{ formatCurrency(dashboard.receitaPendente) }}</span>
        </div>
      </div>

      <div class="kpi-card" [class.alert]="dashboard.receitaAtrasada > 0">
        <div class="kpi-icon red">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">Atrasada</span>
          <span class="kpi-value">{{ formatCurrency(dashboard.receitaAtrasada) }}</span>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon purple" [class.negative]="dashboard.lucroBruto < 0">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/>
            <polyline points="16 7 22 7 22 13"/>
          </svg>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">Lucro Bruto</span>
          <span class="kpi-value" [class.negative]="dashboard.lucroBruto < 0">
            {{ formatCurrency(dashboard.lucroBruto) }}
          </span>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon purple">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
            <path d="M22 12A10 10 0 0 0 12 2v10z"/>
          </svg>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">Margem de Lucro</span>
          <span class="kpi-value">{{ formatPercent(dashboard.margemLucro) }}</span>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon blue">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="4" width="20" height="16" rx="2"/>
            <path d="M7 15h0"/>
            <path d="M2 9.5h20"/>
          </svg>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">Ticket M√©dio</span>
          <span class="kpi-value">{{ formatCurrency(dashboard.ticketMedio) }}</span>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon red">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            <line x1="8" y1="12" x2="18" y2="12"/>
          </svg>
        </div>
        <div class="kpi-content">
          <span class="kpi-label">Despesas Totais</span>
          <span class="kpi-value">{{ formatCurrency(dashboard.despesaTotal) }}</span>
        </div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
      <!-- Receita por Forma de Pagamento -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Receita por Forma de Pagamento</h3>
          <p>Distribui√ß√£o dos m√©todos de pagamento</p>
        </div>
        <div class="chart-body">
          @if (formaPagamentoChartOptions) {
            <apx-chart
              [series]="formaPagamentoChartOptions.series!"
              [chart]="formaPagamentoChartOptions.chart!"
              [labels]="formaPagamentoChartOptions.labels!"
              [colors]="formaPagamentoChartOptions.colors!"
              [dataLabels]="formaPagamentoChartOptions.dataLabels!"
              [legend]="formaPagamentoChartOptions.legend!"
              [responsive]="formaPagamentoChartOptions.responsive!"
            ></apx-chart>
          }
        </div>
      </div>

      <!-- Receita por Conv√™nio -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Receita por Conv√™nio</h3>
          <p>Faturamento por plano de sa√∫de</p>
        </div>
        <div class="chart-body">
          @if (convenioChartOptions) {
            <apx-chart
              [series]="convenioChartOptions.series!"
              [chart]="convenioChartOptions.chart!"
              [plotOptions]="convenioChartOptions.plotOptions!"
              [dataLabels]="convenioChartOptions.dataLabels!"
              [xaxis]="convenioChartOptions.xaxis!"
              [yaxis]="convenioChartOptions.yaxis!"
              [fill]="convenioChartOptions.fill!"
              [colors]="convenioChartOptions.colors!"
              [tooltip]="convenioChartOptions.tooltip!"
            ></apx-chart>
          }
        </div>
      </div>

      <!-- Fluxo de Caixa Di√°rio -->
      <div class="chart-card full-width">
        <div class="chart-header">
          <h3>Fluxo de Caixa Di√°rio</h3>
          <p>Entradas e sa√≠das ao longo do per√≠odo</p>
        </div>
        <div class="chart-body">
          @if (fluxoCaixaChartOptions) {
            <apx-chart
              [series]="fluxoCaixaChartOptions.series!"
              [chart]="fluxoCaixaChartOptions.chart!"
              [stroke]="fluxoCaixaChartOptions.stroke!"
              [xaxis]="fluxoCaixaChartOptions.xaxis!"
              [yaxis]="fluxoCaixaChartOptions.yaxis!"
              [colors]="fluxoCaixaChartOptions.colors!"
              [legend]="fluxoCaixaChartOptions.legend!"
              [tooltip]="fluxoCaixaChartOptions.tooltip!"
            ></apx-chart>
          }
        </div>
      </div>

      <!-- Despesas por Categoria -->
      <div class="chart-card full-width">
        <div class="chart-header">
          <h3>Despesas por Categoria</h3>
          <p>Distribui√ß√£o dos gastos por categoria</p>
        </div>
        <div class="chart-body">
          @if (despesasChartOptions) {
            <apx-chart
              [series]="despesasChartOptions.series!"
              [chart]="despesasChartOptions.chart!"
              [plotOptions]="despesasChartOptions.plotOptions!"
              [dataLabels]="despesasChartOptions.dataLabels!"
              [xaxis]="despesasChartOptions.xaxis!"
              [colors]="despesasChartOptions.colors!"
              [tooltip]="despesasChartOptions.tooltip!"
            ></apx-chart>
          }
        </div>
      </div>
    </div>
  }
</div>
