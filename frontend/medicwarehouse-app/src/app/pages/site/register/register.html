<app-header></app-header>
<div class="register">
  <div class="container">
    <!-- Data Consent Dialog -->
    <div class="consent-dialog-overlay" *ngIf="showDataConsentDialog">
      <div class="consent-dialog">
        <h3>üîí Dados Salvos Encontrados</h3>
        <p>
          Encontramos dados de um cadastro anterior que voc√™ n√£o concluiu. 
          Gostaria de recuper√°-los para continuar de onde parou?
        </p>
        <div class="consent-info">
          <p><strong>Sobre seus dados:</strong></p>
          <ul>
            <li>‚úì Armazenados de forma segura em seu navegador</li>
            <li>‚úì Mantidos por 7 dias ap√≥s o √∫ltimo acesso</li>
            <li>‚úì Voc√™ pode apag√°-los a qualquer momento</li>
            <li>‚úì Em conformidade com a LGPD</li>
          </ul>
        </div>
        <div class="consent-actions">
          <button class="btn btn-primary" (click)="acceptDataConsent()">
            Sim, recuperar meus dados
          </button>
          <button class="btn btn-secondary" (click)="declineDataConsent()">
            N√£o, come√ßar do zero
          </button>
        </div>
      </div>
    </div>

    <div class="register-card">
      <h1>Cadastro de Nova Empresa</h1>
      <p class="subtitle">Complete o cadastro da sua empresa e comece seu teste gratuito por 15 dias</p>

      <div class="plan-summary" *ngIf="selectedPlan">
        <h3>Plano Selecionado: {{ selectedPlan.name }}</h3>
        <p class="plan-price" *ngIf="selectedPlan.monthlyPrice > 0">
          R$ {{ selectedPlan.monthlyPrice }}/m√™s
        </p>
        <p class="trial-badge">‚ú® 15 dias gr√°tis</p>
      </div>

      <div class="steps-indicator">
        <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
          <span class="step-number">1</span>
          <span class="step-label">Empresa</span>
        </div>
        <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
          <span class="step-number">2</span>
          <span class="step-label">Especialidade</span>
        </div>
        <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
          <span class="step-number">3</span>
          <span class="step-label">Endere√ßo</span>
        </div>
        <div class="step" [class.active]="currentStep >= 4" [class.completed]="currentStep > 4">
          <span class="step-number">4</span>
          <span class="step-label">Respons√°vel</span>
        </div>
        <div class="step" [class.active]="currentStep >= 5" [class.completed]="currentStep > 5">
          <span class="step-number">5</span>
          <span class="step-label">Acesso</span>
        </div>
        <div class="step" [class.active]="currentStep >= 6" [class.completed]="currentStep > 6">
          <span class="step-number">6</span>
          <span class="step-label">Plano</span>
        </div>
        <div class="step" [class.active]="currentStep >= 7">
          <span class="step-number">7</span>
          <span class="step-label">Confirmar</span>
        </div>
      </div>

      <div class="alert alert-error" *ngIf="submitError">
        ‚úó {{ submitError }}
      </div>

      <form>
        <!-- Step 1: Company/Clinic Info -->
        <div class="step-content" *ngIf="currentStep === 1">
          <h2>Informa√ß√µes da Empresa</h2>
          
          <!-- Document Type Selector - MOVED TO TOP -->
          <div class="form-group document-type-selector">
            <label>Tipo de Cadastro *</label>
            <div class="radio-group">
              <label class="radio-option">
                <input 
                  type="radio" 
                  name="documentType" 
                  value="CNPJ" 
                  [(ngModel)]="clinicDocumentType"
                  (change)="onDocumentTypeChange('CNPJ')"
                  checked
                />
                <span>CNPJ (Pessoa Jur√≠dica)</span>
              </label>
              <label class="radio-option">
                <input 
                  type="radio" 
                  name="documentType" 
                  value="CPF" 
                  [(ngModel)]="clinicDocumentType"
                  (change)="onDocumentTypeChange('CPF')"
                />
                <span>CPF (Pessoa F√≠sica)</span>
              </label>
            </div>
            <small class="hint">
              <span *ngIf="clinicDocumentType === 'CNPJ'">Para empresas com CNPJ registrado</span>
              <span *ngIf="clinicDocumentType === 'CPF'">Para profissionais aut√¥nomos sem CNPJ</span>
            </small>
          </div>

          <!-- Document Input -->
          <div class="form-group">
            <label *ngIf="clinicDocumentType === 'CNPJ'">CNPJ *</label>
            <label *ngIf="clinicDocumentType === 'CPF'">CPF *</label>
            <input 
              *ngIf="clinicDocumentType === 'CNPJ'"
              type="text" 
              [(ngModel)]="model.clinicDocument" 
              appCnpjMask
              name="clinicDocument" 
              placeholder="00.000.000/0000-00"
              required 
            />
            <input 
              *ngIf="clinicDocumentType === 'CPF'"
              type="text" 
              [(ngModel)]="model.clinicDocument" 
              appCpfMask
              name="clinicDocument" 
              placeholder="000.000.000-00"
              required 
            />
          </div>

          <!-- Checkbox for CPF to enable company fields -->
          <div class="form-group checkbox-group" *ngIf="clinicDocumentType === 'CPF'">
            <label>
              <input 
                type="checkbox" 
                [(ngModel)]="enableCompanyFields" 
                name="enableCompanyFields"
                (change)="onEnableCompanyFieldsChange()"
              />
              <span>Desejo cadastrar nome de empresa/cl√≠nica (opcional)</span>
            </label>
            <small class="hint">
              Como pessoa f√≠sica, voc√™ pode optar por cadastrar somente seus dados pessoais ou tamb√©m informar nome de empresa/cl√≠nica.
            </small>
          </div>

          <p class="info-text" *ngIf="clinicDocumentType === 'CNPJ' || enableCompanyFields">
            <strong>‚ÑπÔ∏è Sobre o cadastro:</strong> Voc√™ est√° cadastrando uma empresa que pode gerenciar uma ou mais cl√≠nicas. 
            Ap√≥s o cadastro, voc√™ poder√° adicionar novas cl√≠nicas no sistema.
          </p>

          <!-- Company Name - only shown for CNPJ or when checkbox is enabled for CPF -->
          <div class="form-group" *ngIf="clinicDocumentType === 'CNPJ' || enableCompanyFields">
            <label>Nome da Empresa *</label>
            <input 
              type="text" 
              [(ngModel)]="model.companyName" 
              name="companyName" 
              [required]="clinicDocumentType === 'CNPJ' || enableCompanyFields"
              placeholder="Ex: Cl√≠nica S√£o Paulo LTDA" 
            />
            <small class="hint">Este √© o nome da sua empresa/raz√£o social</small>
          </div>

          <!-- Clinic Name - only shown for CNPJ or when checkbox is enabled for CPF -->
          <div class="form-group" *ngIf="clinicDocumentType === 'CNPJ' || enableCompanyFields">
            <label>Nome da Primeira Cl√≠nica</label>
            <input type="text" [(ngModel)]="model.clinicName" name="clinicName" placeholder="Ex: Unidade Centro (opcional)" />
            <small class="hint">Opcional - Se n√£o preenchido, usaremos o nome da empresa. Voc√™ pode adicionar mais cl√≠nicas depois.</small>
          </div>

          <!-- Contact Info -->
          <div class="form-group">
            <label>Telefone *</label>
            <input type="tel" [(ngModel)]="model.clinicPhone" appPhoneMask name="clinicPhone" placeholder="(11) 99999-9999" required />
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="model.clinicEmail" name="clinicEmail" required placeholder="contato@suaempresa.com.br" />
            <small class="hint" *ngIf="clinicDocumentType === 'CPF' && !enableCompanyFields">Este ser√° seu email de contato profissional</small>
            <small class="hint" *ngIf="clinicDocumentType === 'CNPJ' || enableCompanyFields">Email da empresa para contato</small>
          </div>
        </div>

        <!-- Step 2: Specialty Selection -->
        <div class="step-content" *ngIf="currentStep === 2">
          <h2>Selecione sua Especialidade</h2>
          <p class="subtitle">Escolha a √°rea de atua√ß√£o principal da sua {{ clinicDocumentType === 'CPF' && !enableCompanyFields ? 'atividade profissional' : 'cl√≠nica/empresa' }}</p>
          
          <div class="specialty-grid">
            <div class="specialty-option" 
                 *ngFor="let type of clinicTypes"
                 [class.selected]="model.clinicType === type.value"
                 (click)="model.clinicType = type.value">
              <div class="specialty-radio">
                <input 
                  type="radio" 
                  [checked]="model.clinicType === type.value"
                  [value]="type.value"
                  name="clinicType"
                  [(ngModel)]="model.clinicType"
                />
              </div>
              <div class="specialty-details">
                <h3>{{ type.label }}</h3>
                <p class="specialty-description">{{ type.description }}</p>
              </div>
            </div>
          </div>
          
          <div class="info-box">
            <p><strong>‚ÑπÔ∏è Importante:</strong> Esta informa√ß√£o ajuda a personalizar o sistema para suas necessidades espec√≠ficas. 
            Voc√™ poder√° alterar esta configura√ß√£o posteriormente nas configura√ß√µes do sistema.</p>
          </div>
        </div>

        <!-- Step 3: Address -->
        <div class="step-content" *ngIf="currentStep === 3">
          <h2>{{ clinicDocumentType === 'CPF' && !enableCompanyFields ? 'Endere√ßo Profissional' : 'Endere√ßo da Primeira Cl√≠nica' }}</h2>
          <p class="info-text" *ngIf="clinicDocumentType === 'CNPJ' || enableCompanyFields">
            <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Este ser√° o endere√ßo da sua primeira cl√≠nica. 
            Voc√™ pode adicionar endere√ßos de outras cl√≠nicas depois no sistema.
          </p>
          <p class="info-text" *ngIf="clinicDocumentType === 'CPF' && !enableCompanyFields">
            <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Este ser√° seu endere√ßo profissional de atendimento.
          </p>
          <div class="form-group">
            <label>CEP *</label>
            <input 
              type="text" 
              [(ngModel)]="model.zipCode" 
              (blur)="onCepBlur()"
              appCepMask
              name="zipCode" 
              placeholder="00000-000"
              required 
            />
            <small *ngIf="isLoadingCep" class="loading-text">Consultando CEP...</small>
          </div>
          <div class="form-row">
            <div class="form-group" style="flex: 3;">
              <label>Rua *</label>
              <input type="text" [(ngModel)]="model.street" name="street" required />
            </div>
            <div class="form-group" style="flex: 1;">
              <label>N√∫mero *</label>
              <input type="text" [(ngModel)]="model.number" name="number" required />
            </div>
          </div>
          <div class="form-group">
            <label>Complemento</label>
            <input type="text" [(ngModel)]="model.complement" name="complement" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Bairro *</label>
              <input type="text" [(ngModel)]="model.neighborhood" name="neighborhood" required />
            </div>
            <div class="form-group">
              <label>Cidade *</label>
              <input type="text" [(ngModel)]="model.city" name="city" required />
            </div>
            <div class="form-group" style="flex: 0.5;">
              <label>UF *</label>
              <input type="text" [(ngModel)]="model.state" name="state" maxlength="2" required />
            </div>
          </div>
        </div>

        <!-- Step 4: Owner Info -->
        <div class="step-content" *ngIf="currentStep === 4">
          <h2>Dados do Respons√°vel</h2>
          <div class="form-group">
            <label>Nome Completo *</label>
            <input type="text" [(ngModel)]="model.ownerName" name="ownerName" required />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>CPF *</label>
              <input 
                type="text" 
                [(ngModel)]="model.ownerCPF" 
                appCpfMask
                name="ownerCPF" 
                placeholder="000.000.000-00"
                required 
              />
            </div>
            <div class="form-group">
              <label>Telefone *</label>
              <input type="tel" [(ngModel)]="model.ownerPhone" appPhoneMask name="ownerPhone" placeholder="(11) 99999-9999" required />
            </div>
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="model.ownerEmail" name="ownerEmail" required />
          </div>
        </div>

        <!-- Step 5: Login Credentials -->
        <div class="step-content" *ngIf="currentStep === 5">
          <h2>Criar Acesso</h2>
          <div class="form-group">
            <label>Nome de Usu√°rio *</label>
            <input type="text" [(ngModel)]="model.username" name="username" required />
          </div>
          <div class="form-group">
            <label>Senha *</label>
            <input type="password" [(ngModel)]="model.password" name="password" required />
            <small>M√≠nimo 8 caracteres, incluindo letras e n√∫meros</small>
          </div>
          <div class="form-group">
            <label>Confirmar Senha *</label>
            <input type="password" [(ngModel)]="passwordConfirm" name="passwordConfirm" required />
          </div>
          <div class="password-match" *ngIf="passwordConfirm && model.password !== passwordConfirm">
            <span class="error">‚úó As senhas n√£o coincidem</span>
          </div>
          <div class="password-match" *ngIf="passwordConfirm && model.password === passwordConfirm">
            <span class="success">‚úì As senhas coincidem</span>
          </div>
        </div>

        <!-- Step 6: Plan Selection -->
        <div class="step-content" *ngIf="currentStep === 6">
          <h2>Escolha seu Plano</h2>
          <p class="step-subtitle">Revise ou altere o plano selecionado antes de finalizar</p>

          <div class="plans-selection">
            <div class="plan-option" 
                 *ngFor="let plan of allPlans"
                 [class.selected]="plan.id === selectedPlan?.id"
                 [class.recommended]="plan.isRecommended"
                 (click)="changePlan(plan)">
              <div class="plan-radio">
                <input 
                  type="radio" 
                  [checked]="plan.id === selectedPlan?.id"
                  [value]="plan.id"
                  name="selectedPlan"
                  (change)="changePlan(plan)"
                />
              </div>
              <div class="plan-details">
                <div class="plan-badge" *ngIf="plan.isRecommended">
                  Mais Indicado
                </div>
                <h3>{{ plan.name }}</h3>
                <p class="plan-description">{{ plan.description }}</p>
                <div class="plan-price-inline">
                  <span class="price" *ngIf="plan.monthlyPrice > 0">
                    <strong>R$ {{ plan.monthlyPrice }}</strong>/m√™s
                  </span>
                  <span class="price custom" *ngIf="plan.monthlyPrice === 0">
                    <strong>Sob Consulta</strong>
                  </span>
                  <span class="trial-tag" *ngIf="plan.trialDays > 0">
                    ‚ú® {{ plan.trialDays }} dias gr√°tis
                  </span>
                </div>
                <ul class="plan-features-compact">
                  <li *ngFor="let feature of plan.features.slice(0, 4)">
                    <span class="check">‚úì</span> {{ feature }}
                  </li>
                  <li *ngIf="plan.features.length > 4" class="more-features">
                    +{{ plan.features.length - 4 }} recursos adicionais
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="plan-note">
            <strong>üìã Nota:</strong> Voc√™ poder√° mudar de plano a qualquer momento ap√≥s o cadastro, 
            sem qualquer custo adicional ou taxa de cancelamento.
          </div>
        </div>

        <!-- Step 7: Confirmation -->
        <div class="step-content" *ngIf="currentStep === 7">
          <h2>Confirme seus Dados</h2>
          <div class="summary-section">
            <h3>{{ clinicDocumentType === 'CNPJ' ? 'Empresa' : 'Dados do Cadastro' }}</h3>
            <p *ngIf="model.companyName"><strong>Nome da Empresa:</strong> {{ model.companyName }}</p>
            <p *ngIf="clinicDocumentType === 'CNPJ'"><strong>CNPJ:</strong> {{ model.clinicDocument || model.clinicCNPJ }}</p>
            <p *ngIf="clinicDocumentType === 'CPF'"><strong>CPF:</strong> {{ model.clinicDocument }}</p>
            <p><strong>Email:</strong> {{ model.clinicEmail }}</p>
            <p><strong>Telefone:</strong> {{ model.clinicPhone }}</p>
          </div>
          <div class="summary-section" *ngIf="model.clinicName && model.clinicName !== model.companyName">
            <h3>Primeira Cl√≠nica</h3>
            <p><strong>Nome:</strong> {{ model.clinicName }}</p>
          </div>
          <div class="summary-section">
            <h3>Especialidade</h3>
            <p><strong>{{ getClinicTypeLabel(model.clinicType) }}</strong></p>
          </div>
          <div class="summary-section">
            <h3>{{ clinicDocumentType === 'CPF' && !enableCompanyFields ? 'Endere√ßo Profissional' : 'Endere√ßo da Primeira Cl√≠nica' }}</h3>
            <p>{{ model.street }}, {{ model.number }} {{ model.complement }}</p>
            <p>{{ model.neighborhood }} - {{ model.city }}/{{ model.state }}</p>
            <p>CEP: {{ model.zipCode }}</p>
          </div>
          <div class="summary-section">
            <h3>Respons√°vel</h3>
            <p><strong>Nome:</strong> {{ model.ownerName }}</p>
            <p><strong>CPF:</strong> {{ model.ownerCPF }}</p>
            <p><strong>Email:</strong> {{ model.ownerEmail }}</p>
          </div>
          <div class="summary-section">
            <h3>Plano</h3>
            <p *ngIf="selectedPlan"><strong>{{ selectedPlan.name }}</strong> - R$ {{ selectedPlan.monthlyPrice }}/m√™s</p>
            <p class="trial-info">‚ú® Per√≠odo de teste: 15 dias gr√°tis</p>
          </div>

          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="model.acceptTerms" name="acceptTerms" />
              <span>Aceito os <a routerLink="/site/terms" target="_blank">Termos de Uso</a> e a <a routerLink="/site/privacy" target="_blank">Pol√≠tica de Privacidade</a> *</span>
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="prevStep()" *ngIf="currentStep > 1" [disabled]="isSubmitting">
            Voltar
          </button>
          <button type="button" class="btn btn-primary" (click)="nextStep()" *ngIf="currentStep < 7" [disabled]="!validateStep(currentStep)">
            Pr√≥ximo
          </button>
          <button type="button" class="btn btn-primary" (click)="onSubmit()" *ngIf="currentStep === 7" [disabled]="!model.acceptTerms || isSubmitting">
            <span *ngIf="!isSubmitting">Finalizar Cadastro</span>
            <span *ngIf="isSubmitting">Processando...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<app-footer></app-footer>
