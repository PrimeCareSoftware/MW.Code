<div class="notification-trigger">
  <button class="notification-button" (click)="togglePanel()" [class.has-unread]="unreadCount() > 0">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
      <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
    </svg>
    @if (unreadCount() > 0) {
      <span class="badge">{{ unreadCount() }}</span>
    }
  </button>
</div>

@if (isOpen()) {
  <div class="notification-panel">
    <div class="panel-header">
      <h3>Notificações</h3>
      @if (unreadCount() > 0) {
        <button class="btn-text" (click)="markAllAsRead()">Marcar todas como lidas</button>
      }
    </div>

    <div class="notifications-list">
      @if (notifications().length === 0) {
        <div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <p>Nenhuma notificação</p>
        </div>
      } @else {
        @for (notification of notifications(); track notification.id) {
          <div 
            class="notification-item"
            [class.unread]="!notification.isRead"
            (click)="markAsRead(notification)"
          >
            <div class="notification-icon">
              {{ getNotificationIcon(notification) }}
            </div>
            <div class="notification-content">
              <div class="notification-header">
                <strong>{{ notification.title }}</strong>
                <span class="notification-time">{{ formatTime(notification.createdAt) }}</span>
              </div>
              <p class="notification-message">{{ notification.message }}</p>
              @if (notification.data?.nextPatientName) {
                <div class="next-patient">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"></path>
                  </svg>
                  Próximo: {{ notification.data?.nextPatientName }}
                </div>
              }
            </div>
            <button 
              class="btn-delete" 
              (click)="deleteNotification(notification); $event.stopPropagation()"
              title="Remover"
            >
              ✕
            </button>
          </div>
        }
      }
    </div>

    <div class="panel-footer">
      <button class="btn-text" (click)="requestNotificationPermission()">
        Ativar notificações do navegador
      </button>
    </div>
  </div>
}

@if (isOpen()) {
  <div class="notification-overlay" (click)="togglePanel()"></div>
}
