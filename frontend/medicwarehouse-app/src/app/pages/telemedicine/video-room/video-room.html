<div class="video-room-container">
  @if (errorMessage()) {
    <div class="error-overlay">
      <div class="error-content">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
        <h2>{{ errorMessage() }}</h2>
        <a href="/telemedicine" class="btn-primary">Voltar</a>
      </div>
    </div>
  } @else {
    @if (isLoading()) {
      <div class="loading-overlay">
        <div class="spinner"></div>
        <p>Conectando à sala de vídeo...</p>
      </div>
    }

    <div class="video-header">
      <div class="session-info">
        @if (session()) {
          <h2>Sessão de Telemedicina</h2>
          <div class="timer">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            {{ elapsedTime() }}
          </div>
          @if (joinInfo()) {
            <div class="timer">{{ joinInfo()?.provider }}</div>
            <div class="timer">Espera: {{ joinInfo()?.waitingRoomEnabled ? 'On' : 'Off' }}</div>
            <div class="timer">Gravação: {{ joinInfo()?.recordingAvailable ? 'On' : 'Off' }}</div>
            <div class="timer">Chat: {{ joinInfo()?.chatAvailable ? 'On' : 'Off' }}</div>
            <div class="timer">Tela: {{ joinInfo()?.screenSharingAvailable ? 'On' : 'Off' }}</div>
          }
        }
      </div>
      
      <div class="header-actions">
        <button class="btn-icon quality-indicator" title="Qualidade da conexão">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 20h.01"/>
            <path d="M7 20v-4"/>
            <path d="M12 20v-8"/>
            <path d="M17 20V8"/>
            <path d="M22 4v16"/>
          </svg>
        </button>
      </div>
    </div>

    <div id="video-container" class="video-content"></div>

    <div class="video-controls">
      <div class="controls-group">
        <button 
          (click)="toggleAudio()" 
          class="control-btn"
          [class.active]="!isAudioMuted()"
          title="Microfone">
          @if (isAudioMuted()) {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="1" y1="1" x2="23" y2="23"/>
              <path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"/>
              <path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"/>
              <line x1="12" y1="19" x2="12" y2="23"/>
              <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
              <line x1="12" y1="19" x2="12" y2="23"/>
              <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
          }
          <span>{{ isAudioMuted() ? 'Ativar' : 'Mudo' }}</span>
        </button>

        <button 
          (click)="toggleVideo()" 
          class="control-btn"
          [class.active]="!isVideoOff()"
          title="Câmera">
          @if (isVideoOff()) {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="1" y1="1" x2="23" y2="23"/>
              <path d="M21 21H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h3m3-3h6l2 3h4a2 2 0 0 1 2 2v9.34m-7.72-2.06a4 4 0 1 1-5.56-5.56"/>
            </svg>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="23 7 16 12 23 17 23 7"/>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
            </svg>
          }
          <span>{{ isVideoOff() ? 'Ligar' : 'Desligar' }}</span>
        </button>

        <button (click)="endSession()" class="control-btn btn-end" title="Encerrar sessão">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            <line x1="23" y1="1" x2="17" y2="7"/>
            <line x1="17" y1="1" x2="23" y2="7"/>
          </svg>
          <span>Encerrar</span>
        </button>
      </div>
    </div>
  }
</div>
