<div class="performance-dashboard-container">
  
  
  <div class="page-header">
    <div class="header-content">
      <h1>Dashboard de Performance TISS</h1>
      <p>Acompanhamento de indicadores e métricas de performance das operadoras</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="exportToPDF()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Exportar PDF
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="form-section">
    <div class="section-header">
      <div class="section-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
        </svg>
      </div>
      <div>
        <h3>Filtros</h3>
        <p>Configure o período e opções para análise dos dados</p>
      </div>
    </div>

    <div class="form-grid">
      <div class="form-group">
        <label for="startDate">Data Inicial</label>
        <input 
          type="date" 
          id="startDate"
          class="form-control" 
          [(ngModel)]="startDate"
          (change)="onDateRangeChange()"
        />
      </div>
      <div class="form-group">
        <label for="endDate">Data Final</label>
        <input 
          type="date" 
          id="endDate"
          class="form-control" 
          [(ngModel)]="endDate"
          (change)="onDateRangeChange()"
        />
      </div>
      <div class="form-group">
        <label for="performanceMonths">Meses de Comparação</label>
        <select 
          id="performanceMonths"
          class="form-control" 
          [(ngModel)]="performanceMonths"
          (change)="onPerformanceMonthsChange()"
        >
          <option [value]="6">6 meses</option>
          <option [value]="12">12 meses</option>
          <option [value]="18">18 meses</option>
          <option [value]="24">24 meses</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Carregando dados de performance...</p>
    </div>
  }

  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="alert alert-error">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>{{ errorMessage() }}</span>
    </div>
  }

  <!-- Dashboard Content -->
  @if (hasData() && !isLoading()) {
    
    <!-- Summary Cards -->
    <div class="summary-section">
      <div class="section-header">
        <div class="section-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
        </div>
        <div>
          <h3>Indicadores Gerais</h3>
          <p>Métricas principais de performance consolidadas</p>
        </div>
      </div>

      <div class="summary-grid">
        <div class="summary-card">
          <h6>Taxa Média de Aprovação</h6>
          <h3 [ngClass]="getAuthRateClass(averageAuthorizationRate())">
            {{ formatPercentage(averageAuthorizationRate()) }}
          </h3>
          <small>Média entre todas as operadoras</small>
        </div>
        <div class="summary-card">
          <h6>Tempo Médio de Aprovação</h6>
          <h3 [ngClass]="getApprovalDaysClass(averageApprovalDays())">
            {{ formatDays(averageApprovalDays()) }}
          </h3>
          <small>Média entre todas as operadoras</small>
        </div>
      </div>
    </div>

    <!-- Authorization Rate by Operator -->
    @if (authorizationData().length > 0) {
      <div class="authorization-section">
        <div class="section-header">
          <div class="section-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <h3>Taxa de Aprovação de Autorizações Prévias</h3>
            <p>Detalhamento por operadora das solicitações aprovadas e rejeitadas</p>
          </div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Operadora</th>
                <th>Total de Solicitações</th>
                <th>Aprovadas</th>
                <th>Rejeitadas</th>
                <th>Pendentes</th>
                <th>Taxa de Aprovação</th>
              </tr>
            </thead>
            <tbody>
              @for (auth of authorizationData(); track auth.operatorId) {
                <tr>
                  <td>{{ auth.operatorName }}</td>
                  <td>{{ auth.totalRequests }}</td>
                  <td class="text-success">{{ auth.approvedRequests }}</td>
                  <td class="text-danger">{{ auth.rejectedRequests }}</td>
                  <td class="text-warning">{{ auth.pendingRequests }}</td>
                  <td>
                    <span 
                      class="badge" 
                      [ngClass]="auth.approvalRate >= 90 ? 'badge-success' : 
                                 auth.approvalRate >= 70 ? 'badge-warning' : 'badge-error'"
                    >
                      {{ formatPercentage(auth.approvalRate) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- Approval Time by Operator -->
    @if (approvalTimeData().length > 0) {
      <div class="approval-time-section">
        <div class="section-header">
          <div class="section-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <h3>Tempo Médio de Aprovação por Operadora</h3>
            <p>Análise dos prazos de processamento e aprovação das operadoras</p>
          </div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Operadora</th>
                <th>Tempo Médio</th>
                <th>Tempo Mínimo</th>
                <th>Tempo Máximo</th>
                <th>Lotes Processados</th>
              </tr>
            </thead>
            <tbody>
              @for (approval of approvalTimeData(); track approval.operatorId) {
                <tr>
                  <td>{{ approval.operatorName }}</td>
                  <td>
                    <span [ngClass]="getApprovalDaysClass(approval.averageApprovalDays)">
                      {{ formatDays(approval.averageApprovalDays) }}
                    </span>
                  </td>
                  <td class="text-success">{{ formatDays(approval.minApprovalDays) }}</td>
                  <td class="text-danger">{{ formatDays(approval.maxApprovalDays) }}</td>
                  <td>{{ approval.totalProcessed }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- Monthly Performance Comparison -->
    @if (monthlyPerformance().length > 0) {
      <div class="monthly-performance-section">
        <div class="section-header">
          <div class="section-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
            </svg>
          </div>
          <div>
            <h3>Comparativo Mensal de Performance</h3>
            <p>Evolução histórica de faturamento, aprovações e glosas</p>
          </div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Período</th>
                <th>Total Faturado</th>
                <th>Total Aprovado</th>
                <th>Taxa de Glosa</th>
                <th>Tempo Médio Aprovação</th>
                <th>Guias</th>
              </tr>
            </thead>
            <tbody>
              @for (month of monthlyPerformance(); track month.monthName) {
                <tr>
                  <td>{{ month.monthName }}</td>
                  <td>{{ formatCurrency(month.totalBilled) }}</td>
                  <td class="text-success">{{ formatCurrency(month.totalApproved) }}</td>
                  <td>
                    <span 
                      class="badge" 
                      [ngClass]="month.glosaPercentage > 15 ? 'badge-error' : 
                                 month.glosaPercentage > 10 ? 'badge-warning' : 'badge-success'"
                    >
                      {{ formatPercentage(month.glosaPercentage) }}
                    </span>
                  </td>
                  <td>
                    <span [ngClass]="getApprovalDaysClass(month.averageApprovalDays)">
                      {{ formatDays(month.averageApprovalDays) }}
                    </span>
                  </td>
                  <td>{{ month.totalGuides }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  }

  @if (!hasData() && !isLoading() && !errorMessage()) {
    <div class="empty-state">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
      </svg>
      <h3>Nenhum dado disponível</h3>
      <p>Selecione os filtros acima para carregar os dados de performance</p>
    </div>
  }
</div>
