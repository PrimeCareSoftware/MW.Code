<app-navbar></app-navbar>

<!-- Setup Wizard -->
<app-setup-wizard 
  *ngIf="showWizard"
  (complete)="onWizardComplete($event)"
  (cancel)="closeWizard()"
></app-setup-wizard>

<div class="business-configuration-container">
  <div class="page-header">
    <h1>Configura√ß√£o do Neg√≥cio</h1>
    <p class="subtitle">Configure o tipo de neg√≥cio, especialidade e recursos dispon√≠veis</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Carregando configura√ß√£o...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-error">
    <span class="icon">‚ö†Ô∏è</span>
    <span>{{ error }}</span>
  </div>

  <!-- Success State -->
  <div *ngIf="success" class="alert alert-success">
    <span class="icon">‚úì</span>
    <span>{{ success }}</span>
  </div>

  <!-- Configuration Form -->
  <div *ngIf="!loading && configuration" class="configuration-form">
    
    <!-- Business Type Section -->
    <section class="config-section">
      <h2>Tipo de Neg√≥cio</h2>
      <p class="section-description">
        Selecione o porte da sua cl√≠nica. Isso ajustar√° automaticamente os recursos recomendados.
      </p>
      
      <div class="business-type-grid">
        <div 
          *ngFor="let option of businessTypeOptions" 
          class="business-type-card"
          [class.selected]="configuration.businessType === option.value"
          (click)="configuration.businessType = option.value; updateBusinessType()"
        >
          <h3>{{ option.label }}</h3>
          <p>{{ option.description }}</p>
        </div>
      </div>
    </section>

    <!-- Specialty Section -->
    <section class="config-section">
      <h2>Especialidade Principal</h2>
      <p class="section-description">
        A especialidade define a terminologia e recursos adequados ao seu tipo de pr√°tica.
      </p>
      
      <div class="specialty-grid">
        <div 
          *ngFor="let option of specialtyOptions" 
          class="specialty-card"
          [class.selected]="configuration.primarySpecialty === option.value"
          (click)="configuration.primarySpecialty = option.value; updatePrimarySpecialty()"
        >
          <span class="specialty-icon">{{ option.icon }}</span>
          <span class="specialty-label">{{ option.label }}</span>
        </div>
      </div>
    </section>

    <!-- Schedule Settings Section -->
    <section class="config-section">
      <h2>Hor√°rio de Atendimento</h2>
      <p class="section-description">
        Configure os hor√°rios de funcionamento da cl√≠nica e dura√ß√£o das consultas.
      </p>

      <div class="schedule-settings-form">
        <div class="form-row">
          <div class="form-group">
            <label for="openingTime">Hor√°rio de Abertura</label>
            <input 
              type="time" 
              id="openingTime" 
              [(ngModel)]="openingTime"
              class="time-input"
            >
          </div>

          <div class="form-group">
            <label for="closingTime">Hor√°rio de Fechamento</label>
            <input 
              type="time" 
              id="closingTime" 
              [(ngModel)]="closingTime"
              class="time-input"
            >
          </div>

          <div class="form-group">
            <label for="appointmentDuration">Dura√ß√£o da Consulta</label>
            <select 
              id="appointmentDuration" 
              [(ngModel)]="appointmentDurationMinutes"
              class="select-input"
            >
              <option *ngFor="let option of appointmentDurationOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-row toggles-row">
          <div class="toggle-group">
            <label class="toggle-label">
              <input 
                type="checkbox" 
                [(ngModel)]="allowEmergencySlots"
              >
              <span class="toggle-text">Permitir hor√°rios de emerg√™ncia</span>
            </label>
            <p class="toggle-description">Permite agendamentos fora do hor√°rio normal para emerg√™ncias</p>
          </div>

          <div class="toggle-group">
            <label class="toggle-label">
              <input 
                type="checkbox" 
                [(ngModel)]="enableOnlineAppointmentScheduling"
              >
              <span class="toggle-text">Agendamento online habilitado</span>
            </label>
            <p class="toggle-description">Permite que pacientes agendem consultas pelo portal</p>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-primary"
            (click)="updateScheduleSettings()"
            [disabled]="savingSchedule"
          >
            {{ savingSchedule ? 'Salvando...' : 'Salvar Configura√ß√µes de Hor√°rio' }}
          </button>
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section class="config-section">
      <h2>Recursos e Funcionalidades</h2>
      <p class="section-description">
        Ative ou desative recursos de acordo com as necessidades da sua cl√≠nica.
      </p>

      <div class="features-container">
        <div *ngFor="let category of featureCategories" class="feature-category">
          <h3 class="category-title">{{ category.name }}</h3>
          
          <div class="features-list">
            <div *ngFor="let feature of category.features" class="feature-item">
              <div class="feature-info">
                <label class="feature-label">{{ feature.label }}</label>
                <p class="feature-description">{{ feature.description }}</p>
              </div>
              <div class="feature-toggle">
                <label class="switch">
                  <input 
                    type="checkbox" 
                    [checked]="feature.enabled"
                    (change)="toggleFeature(feature.key, $any($event.target).checked)"
                  >
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Configuration Summary -->
    <section class="config-section summary-section">
      <h2>Resumo da Configura√ß√£o</h2>
      <div class="summary-grid">
        <div class="summary-item">
          <label>Tipo de Neg√≥cio:</label>
          <span>{{ getBusinessTypeLabel(configuration.businessType) }}</span>
        </div>
        <div class="summary-item">
          <label>Especialidade:</label>
          <span>{{ getSpecialtyLabel(configuration.primarySpecialty) }}</span>
        </div>
        <div class="summary-item">
          <label>√öltima Atualiza√ß√£o:</label>
          <span>{{ configuration.updatedAt | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>
    </section>
  </div>

  <!-- No Configuration State -->
  <div *ngIf="!loading && !configuration && !error" class="no-config-state">
    <div class="empty-state-icon">‚öôÔ∏è</div>
    <h2>Configure sua cl√≠nica em minutos</h2>
    <p class="subtitle-large">Escolha entre configura√ß√£o r√°pida ou personalizada</p>
    
    <div class="action-buttons">
      <button 
        class="btn btn-primary btn-wizard"
        (click)="openWizard()"
        [disabled]="saving"
      >
        <span class="btn-icon">‚ú®</span>
        <span class="btn-content">
          <span class="btn-title">Configura√ß√£o R√°pida (Recomendado)</span>
          <span class="btn-subtitle">Assistente em 3 passos simples</span>
        </span>
      </button>

      <button 
        class="btn btn-secondary btn-manual"
        (click)="createConfiguration()"
        [disabled]="saving"
      >
        <span class="btn-icon">‚öôÔ∏è</span>
        <span class="btn-content">
          <span class="btn-title">Configura√ß√£o Manual</span>
          <span class="btn-subtitle">Configure tudo do seu jeito</span>
        </span>
      </button>
    </div>

    <div class="features-preview">
      <h3>O que voc√™ pode configurar:</h3>
      <div class="features-grid">
        <div class="feature-badge">üìã Tipo de neg√≥cio e especialidade</div>
        <div class="feature-badge">üïê Hor√°rios de atendimento</div>
        <div class="feature-badge">üíä Recursos cl√≠nicos</div>
        <div class="feature-badge">üí≥ Gest√£o financeira</div>
        <div class="feature-badge">üåê Agendamento online</div>
        <div class="feature-badge">üìä E muito mais...</div>
      </div>
    </div>
  </div>
</div>
